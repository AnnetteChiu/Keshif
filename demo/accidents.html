<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Accidents - Road Safety 2012 - UK (reports by Police Force 4 only)</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="../js/d3.3.5.5.min.js" charset="utf-8"></script>
		<script type="text/javascript" src="../keshif.js" charset="utf-8"></script>
		<link rel="stylesheet" href="../keshif.css"/ type="text/css">
        <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">

        <script type="text/javascript" src="./js/demo.js" charset="utf-8"></script>
        <link rel="stylesheet" href="./css/style.css"/ type="text/css">

        <script type="text/javascript">
var QueryString = function () {
  // This function is anonymous, is executed immediately and 
  // the return value is assigned to QueryString!
  var query_string = {};
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
        // If first entry with this name
    if (typeof query_string[pair[0]] === "undefined") {
      query_string[pair[0]] = pair[1];
        // If second entry with this name
    } else if (typeof query_string[pair[0]] === "string") {
      var arr = [ query_string[pair[0]], pair[1] ];
      query_string[pair[0]] = arr;
        // If third or later entry with this name
    } else {
      query_string[pair[0]].push(pair[1]);
    }
  } 
    return query_string;
} ();

google.setOnLoadCallback( function(){
    
    resizeBrowser(240,50);
    $(window).resize(function() {
        resizeBrowser(240,50);
        browser.updateLayout();
    });

    var query = 'select *';
    var sheetInfo = {name:"Accidents"};
    if(QueryString.set==="small") {
        sheetInfo.range = "A1:S100";
    }

	browser = new kshf.Browser({
        domID: "#chart_div",
        categoryTextWidth:170,
        source: {
            gdocId: '0Ai6LdDWgaqgNdFJlc0NzcHZFclMzakFkOUpiQVFXb1E',
            sheets: [ sheetInfo, {name:"RoadType"}, {name:"RoadSurface"}, 
                {name:"JuncDet"}, {name:"JuncCont"}, {name:"SpecCond"},
                {name:"Severity"}, {name:"LightCond"}, {name:"WeatherCond"}
            ]
        },
        facets: [
            {   title: "Road Type", catTableName: "RoadType", catLabel: "name"
            },{ title: "Severity", catTableName: "Severity", catLabel: "name"
            },{ title: "Area", catLabel: function(){ return (this.id===1)?"Urban":"Rural"; }
            },{ title: "Time of Day", attribMap: function(){ return this['Time of Day'].getHours(); },
                layout: "middle", unitName: ":00"
            },{ title: "Speed Limit", unitName: "mph", layout: 'middle'
            },{ title: "# of Vehicles", layout: 'middle'
            },{ title: "Road Surface Condition", catTableName: "RoadSurface", catLabel: "name", layout: 'right'
            },{ title: "Light Condition", catTableName: "LightCond", catLabel: "name"
            },{ title: "Weather Condition", catTableName: "WeatherCond", catLabel: "name"
            },{ title: "Special Condition", catTableName: "SpecCond", catLabel: "name", layout: 'right',
            },{ title: "Junction Detail", catTableName: "JuncDet", catLabel: "name", layout: 'right',
            },{ title: "Junction Control", catTableName: "JuncCont",  catLabel: "name", layout: 'right'
            },{ title: "Date", layout: 'bottom'
            }
        ],
        itemDisplay: {
            sortColWidth: 70,
            sortingOpts: [{
                name: 'Date', label: function(){ return (this.Date.getUTCMonth()+1)+"-"+this.Date.getUTCFullYear(); }
            }],
            detailsToggle: "zoom",
            recordView: 'Accident_Index'
        }
    });
});
</script>
	</head>
    <body>
        <div class="contents"><div id="chart_div"></div></div>
    </body>
</html>