<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>InfoVis 2014 Contest</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="../js/d3.3.5.5.min.js" charset="utf-8"></script>
        <script type="text/javascript" src="../keshif.js" charset="utf-8"></script>
        <link rel="stylesheet" href="../keshif.css"/ type="text/css">
        <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">

        <script type="text/javascript" src="./js/demo.js" charset="utf-8"></script>
        <link rel="stylesheet" href="./css/style.css"/ type="text/css">

        <script type="text/javascript">

var loadData = function(browser){
    $.ajax( {
        // Cannot load remote resouce because it is in another domain
        // url:"http://research.microsoft.com/en-us/um/people/bibuxton/buxtoncollection/data/PivotViewer.xml",
        url:"./data/iv04.xml",
        dataType:"xml",
        async: false,
        success: function(collection){
            var $collection = $(collection);
            browser.primaryTableName = "Papers";
            kshf.dt.Papers = [];
            kshf.dt.Authors = [];
            kshf.dt_id.Authors = {};
            kshf.dt_id.Papers = {};

            $collection.find("> articles > article").each(function(){
                var $this = $(this);
                var cData = {};
                cData.id = $this.attr("id");
                cData.Title = $this.find("title").text();
                cData.Source = $this.find("source").text();
                cData.Abstract = $this.find("abstract").text();
                cData.Year = $this.find("date").attr("from");
                cData.url = $this.find("abstract").text();
                if(cData.Year){
                    // parse the string into a date object
                    cData.Date = new Date(cData.Year,1,1);
                }
                cData.Keywords = $this.find("keywords").text().split(/\s*,\s*/);
                for(var i=0; i<cData.Keywords.length; i++){
                    cData.Keywords[i] = kshf.Util.toProperCase(cData.Keywords[i])
                        .replace(/\./g, '')
                        .replace("Three-Dimensional", '3D')
                        .replace("3d", '3D')
                        .replace("3-D", '3D')
                        .replace("Visualisation","Visualization")
                        .replace("Tools", "Tool")
                        ;
                }
                
                // Authors
                cData.Authors = [];
                $this.find("authors > author_ref").each(function(author){
                    var ref  = this.getAttribute("ref");
                    var name = this.textContent;
                    cData.Authors.push(ref);
                    kshf.dt_id.Authors[ref] = name;
                });

                // References // TODO
                cData.References_Internal = [];
                cData.References_External = [];
                cData.References_Other = [];
                kshf.dt_id.References = {}
                $this.find("references > ref").each(function(author){
                    var ref  = this.getAttribute("ref");
                    if(ref){
                        if(ref.substring(0,2)==="id"){
                            cData.References_External.push(ref);
                            kshf.dt_id.References[ref] = this.textContent;
                        } else {
                            cData.References_Internal.push(ref);
                        }
                    } else {
                        cData.References_Other.push(this.textContent);
                    }
                });

                var item = new kshf.Item(cData,"id");
                kshf.dt.Papers.push(item);
                kshf.dt_id.Papers[item.id()] = item;
            });

            // Go over the items and add the papers that reference to this paper
            kshf.dt.Papers.forEach(function(paper){
                paper.data.References_To = []
                paper.data.References_Internal.forEach(function(ref){
                    var refPaper = kshf.dt_id.Papers[ref];
                    if(refPaper){
                        paper.data.References_To.push(ref);
                    }
                });
            });

            browser.loadCharts();   
        }
    });
};

$(document).ready( function(){
    new kshf.Browser({
        domID: "#chart_div",
        itemName: "Papers",
        leftPanelLabelWidth: 160,
        rightPanelLabelWidth: 200,
        barChartWidth: 80,
        source: {
            url: 'http://www.cs.umd.edu/hcil/iv04contest',    
            callback: loadData
        },
        facets: [
            {   title: "Authors",
                catLabelText: function(d){ return kshf.dt_id.Authors[d.data[0]]; }
            },{ title: "Keywords", layout: 'right'
            },{ title: "# of Keywords", layout: 'right', collapsed: true,
                attribMap: function(d){ return d.data.Keywords.length; }
            },{ title: "Abstract", layout: 'right',
                attribMap: function(d){ if(d.data.Abstract) return "Has Abstract"; }
            },{ title: "# References To (Within)", layout: 'right',
                attribMap: function(d){ return d.data.References_To.length; }, 
                intervalScale: 'log'
            },{ title: "# References Within (Total)", layout: 'right',  collapsed: true,
                attribMap: function(d){
                    return d.data.References_Internal.length+
                        d.data.References_External.length+
                        d.data.References_Other.length;
                }
            },{ title: "# References Within (Internal)", layout: 'right', collapsed: true,
                attribMap: function(d){ return d.data.References_Internal.length; }
            },{ title: "# References Within (External + Other)", layout: 'right', collapsed: true,
                attribMap: function(d){ return d.data.References_External.length+d.data.References_Other.length; }
            },{ title: "Date", layout: "bottom"
            }
        ],
        itemDisplay: {
            sortColWidth: 65,
            sortingOpts: [
                { name: "#Ref's", value: function(d){return d.data.References_To.length;} },
                { name: 'Year' }
                ],
            detailsToggle: 'zoom',
            textSearch: "Title",
            recordView: "Title"
        }
    });
});
        </script>
        <style>
            #chart_div {
                height: 700px;
                width: 1100px;
            }
        </style>
    </head>
    <body>
        <div class="pageTitle" align="center">InfoVis 2004 Contest - Papers</div>
        <div class="contents"><div id="chart_div"></div></div>
        <div id="infobox" align="center">
            <span class="fa fa-info-circle"></span>
            Fekete, J.-D., Grinstein, G., Plaisant, C., IEEE InfoVis 2004 Contest, the history of InfoVis, <a href="http://www.cs.umd.edu/hcil/iv04contest" target="_blank">www.cs.umd.edu/hcil/iv04contest</a> (2004)
            <span class="fa fa-info-circle"></span>
            </div>
    </body>
</html>