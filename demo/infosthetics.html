<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>5 Years of Infosthetics</title>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
		<script type="text/javascript" src="./jquery/jquery-1.9.1.min.js"></script>
<!--	I have custom changes which affect element insertion/deletion -- LIST DISPLAY 
			<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
		<script type="text/javascript" src="./d3.v3/d3.v3.js" charset="utf-8"></script>
		<script type="text/javascript" src="./keshif.js" charset="utf-8"></script>
        <link rel="stylesheet" href="magnific-popup/magnific-popup.css"> 
		<link rel="stylesheet" type="text/css" href="./keshif.css"/>

        <script type="text/javascript" src="moment.min.js" charset="utf-8"></script>
        <script src="magnific-popup/jquery.magnific-popup.js"></script> 
<script type="text/javascript">

function getNumComments(v){
    if(v==0) return "None";
    if(v<6) return "1-5";
    if(v<11) return "6-10";
    if(v<21) return "11-20";
    return ">20";
}

function resetSize(){
    $('#chart_div4').height($(window).height()-10);
//    $('#chart_div4').height(730);
    $('#chart_div4').width (900);
}

function loadChart() {
    var postCols;
    resetSize();
    // set resize callback
    $(window).resize(function() {
        resetSize();
        kshf.updateLayout();
    });
    
	kshf.init({
        chartTitle: "5 Years of Infosthetics",
        domID : "#chart_div4",
        itemName : "posts",
        categoryTextWidth:186,
        source : {
            gdocId : '0Ai6LdDWgaqgNdFhuMXh0V1E2Wk5tU19JaDltUWVMVnc',
            sheets : [ {name:"Posts"}]
        },
        loadedCb: function(){
            postCols = kshf.dt_ColNames.Posts;
            kshf.cellToArray(kshf.dt.Posts, [postCols.categories], ",", false);
        },
        charts: [
            {
                facetTitle: "Categories",
                itemMapFunc : function(post){ return post.data[postCols.categories]; },
                filter: { rowConj: 'in category' }
            },{
                facetTitle: "# of comments",
                itemMapFunc : function(post){ return getNumComments(post.data[postCols.comments]); },
                filter: { rowConj: 'in category' }
            },{
                facetTitle: "Year",
                itemMapFunc : function(post){ return post.data[postCols.date].getUTCFullYear(); },
                filter: { rowConj: 'in category' }
            },{
                facetTitle: "Author",
                itemMapFuncf : function(post){ return post.data[postCols.author]; },
                catDispCountFix: 6,
                filter: { rowConj: 'in category' }
            }
        ],
        list:{
            sortOpts : [
                {   name: 'Date',
                    width: 45,
                    value: function(d){ return d.data[postCols.date].getUTCFullYear(); },
                    value_type : 'number'
                }
            ],
            textSearch : function (d) { return d.data[postCols.title]; },
            textSearchTitle : "post title",
            contentFunc : function(d) {
                var j;
                var str="";
                
                str+="<img src=\""+d.data[postCols.img]+"\" width=\"80\" style=\"float:left\">";
                str+="<div style=\"position: relative; left:5px; width:calc(100% - 85px);\">";

                // title
                str+="<div class=\"iteminfo iteminfo_0\">";
                str+="<a href=\""+d.data[postCols.url]+"\" target=\"_blanl\">"+d.data[postCols.title]+"<a/>";
                str+="</div>";

                // categories
                str+="<div class=\"iteminfo iteminfo_1\">";
                str+="About: "+d.data[postCols.categories];
                str+="</div>";

                // author
                str+="<div class=\"iteminfo iteminfo_1\">";
                str+="Written by: "+d.data[postCols.author]+" Comments: "+d.data[postCols.comments];
                str+="</div>";

                str+="</div>";
                return str;
            }
        }
    });
}

$(document).ready(loadChart);

</script>
<style>

div.listItem{
    padding-bottom: 4px;
}

.iteminfo a{
    color:#606060;
    font-style:italic;
}

#chart_div4 {
    margin: 0 auto;
/*    top: 50px;*/
}

.leftBlockAdjustSize{
    display: none;
}

body{ margin:2px; }

</style>
	</head>
	<body>
		<div id="chart_div4"></div>
	</body>
</html>