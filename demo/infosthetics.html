<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>5 Years of Infosthetics</title>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script type="text/javascript" src="../jquery/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="../d3.v3/d3.v3.js" charset="utf-8"></script>
        <script type="text/javascript" src="../keshif.js" charset="utf-8"></script>
        <link rel="stylesheet" href="../keshif.css"/ type="text/css">

        <script type="text/javascript" src="moment.min.js" charset="utf-8"></script>
        <script type="text/javascript">

function getNumComments(v){
    if(v==0) return "None";
    if(v<6) return "1-5";
    if(v<11) return "6-10";
    if(v<21) return "11-20";
    return ">20";
}

function resetSize(){
    $('#chart_div4').height($(window).height()-10);
    $('#chart_div4').width (800);
}

function loadChart() {
    var postCols;
    resetSize();
    // set resize callback
    $(window).resize(function() {
        resetSize();
        kshf.updateLayout();
    });
    
	kshf.init({
        chartTitle: "5 Years of Infosthetics",
        domID : "#chart_div4",
        dirRoot: "../",
        itemName : "posts",
        categoryTextWidth:171,
        source : {
            gdocId : '0Ai6LdDWgaqgNdFhuMXh0V1E2Wk5tU19JaDltUWVMVnc',
            sheets : [ {name:"Posts"} ]
        },
        loadedCb: function(){
            postCols = kshf.dt_ColNames.Posts;
            kshf.cellToArray(kshf.dt.Posts, [postCols['Category']], ",", false);
        },
        charts: [
            {   facetTitle: "Category",
                catItemMap : function(post){ return post.data[postCols['Category']]; },
                filter: { rowConj: 'in category' }
            },{
                facetTitle: "# of comments",
                catItemMap : function(post){ return getNumComments(post.data[postCols['# of Comments']]); },
                filter: { rowConj: 'in category' }
            },{
                facetTitle: "Year",
                catItemMap : function(post){ return post.data[postCols['DateTime']].getUTCFullYear(); },
                filter: { rowConj: 'in category' }
            },{
                facetTitle: "Author",
                catItemMap : function(post){ return post.data[postCols['Author']]; },
                catDispCountFix: 6,
                filter: { rowConj: 'in category' }
            }
        ],
        list:{
            sortOpts : [
                {   name: 'Date',
                    width: 45,
                    value: function(d){ return d.data[postCols['DateTime']].getUTCFullYear(); },
                    value_type : 'number'
                }
            ],
            textSearch : function (d) { return d.data[postCols['Title']]; },
            textSearchTitle : "post title",
            contentFunc : function(d) {
                var j;
                var str="";
                
                str+="<img src=\""+d.data[postCols['Img']]+"\" width=\"80\" style=\"float:left\">";
                str+="<div style=\"position: relative; left:5px; width:calc(100% - 85px);\">";

                // title
                str+="<div class=\"iteminfo iteminfo_0\">";
                str+="<a href=\""+d.data[postCols['URL']]+"\" target=\"_blanl\">"+d.data[postCols['Title']]+"<a/>";
                str+="</div>";

                // categories
                str+="<div class=\"iteminfo iteminfo_1\">";
                str+="About: "+d.data[postCols['Categories']];
                str+="</div>";

                // author
                str+="<div class=\"iteminfo iteminfo_1\">";
                str+="Written by: "+d.data[postCols['Author']]+" Comments: "+d.data[postCols['# of Comments']];
                str+="</div>";

                str+="</div>";
                return str;
            }
        }
    });
}

$(document).ready(loadChart);

</script>
<style>
    div.listItem{
        padding-bottom: 4px;
    }
    .iteminfo a{
        color:#606060;
        font-style:italic;
    }
    #chart_div4 {
        margin: 0 auto;
    }
    body{ margin:2px; }
</style>
	</head>
	<body>
		<div id="chart_div4"></div>
	</body>
</html>