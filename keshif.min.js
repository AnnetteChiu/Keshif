function Tipsy(t,e){this.jq_element=$(t),this.options=$.extend({},this.defaults,e)}"undefined"!=typeof google&&google.load("visualization","1",{packages:[]}),"function"!=typeof sendLog&&(sendLog=null);var kshf={queryURL_base:"https://docs.google.com/spreadsheet/tq?key=",surrogateCtor:function(){},extendClass:function(t,e){this.surrogateCtor.prototype=t.prototype,e.prototype=new this.surrogateCtor,e.prototype.constructor=e},num_of_charts:0,num_of_browsers:0,dt:{},dt_id:{},dt_ColNames:{},dt_ColNames_Arr:{},createColumnNames:function(t){this.dt_ColNames[t]={},this.dt_ColNames_Arr[t]=[]},insertColumnName:function(t,e,i){this.dt_ColNames[t][e]=i,this.dt_ColNames_Arr[t][i]=e}};kshf.Util={dif_activeItems:function(t,e){return e.activeItems-t.activeItems},dif_barValue:function(t,e){return e.barValue-t.barValue},sortFunc_ActiveCount_TotalCount:function(t,e){var i=kshf.Util.dif_activeItems(t,e);return 0===i?e.items.length-t.items.length:i},sortFunc_Column_Int_Incr:function(t,e){return t.data[1]-e.data[1]},sortFunc_Column_Int_Decr:function(t,e){return e.data[1]-t.data[1]},sortFunc_Column_ParseInt_Incr:function(t,e){return parseFloat(t.data[1],10)-parseFloat(e.data[1],10)},sortFunc_Column_ParseInt_Decr:function(t,e){return parseFloat(e.data[1],10)-parseFloat(t.data[1],10)},sortFunc_String_Decr:function(t,e){return e.data[1].localeCompare(t.data[1])},sortFunc_String_Incr:function(t,e){return e.data[1].localeCompare(t.data[1])},sortFunc_Time_Last:function(t,e){return void 0!==t.xMax_Dyn&&void 0!==e.xMax_Dyn?e.xMax_Dyn-t.xMax_Dyn:void 0===t.xMax_Dyn&&void 0===e.xMax_Dyn?e.xMax-t.xMax:void 0===e.xMax_Dyn?-1:1},sortFunc_Time_First:function(t,e){return void 0!==t.xMax_Dyn&&void 0!==e.xMax_Dyn?t.xMin_Dyn-e.xMin_Dyn:void 0===t.xMax_Dyn&&void 0===e.xMax_Dyn?t.xMin-e.xMin:void 0===e.xMin_Dyn?-1:1},sortFunc_List_String:function(t,e){return t.localeCompare(e)},sortFunc_List_Date:function(t,e){return null===t?-1:null===e?1:t.getTime()-e.getTime()},sortFunc_List_Number:function(t,e){return e-t},cellToArray:function(t,e,i,s){void 0===i&&(i=/\b\s+/);var a;t.forEach(function(t){t=t.data,e.forEach(function(e){var r=t[e];if(null!==r&&"number"!=typeof r){var o=r.split(i);for(r=[],a=0;a<o.length;a++)o[a]=o[a].trim(),""!==o[a]&&r.push(o[a]);if(s!==!1)for(a=0;a<r.length;a++)r[a]=parseInt(r[a],10);t[e]=r}})})},unescapeCommas:function(t){var e,i=!1,s=[];return t.forEach(function(t){if(i){if(e+=","+t,'"'!==t[t.length-1])return;i=!1}else{if('"'===t[0])return i=!0,e=t.slice(1,t.length-1),void 0;e=t}var a=+e;isNaN(a)||""===e||(e=a),s.push(e)}),s},formatForItemCount:function(t){if(1e3>t)return t;if(1e6>t){var e=t/1e3;return 10>e?Math.floor(t/100)/10+"k":Math.floor(e)+"k"}return 1e9>t?Math.floor(t/1e6)+"m":t},nearestYear:function(t){var e=new Date(Date.UTC(t.getUTCFullYear(),0,1));return t.getUTCMonth()>6&&e.setUTCFullYear(e.getUTCFullYear()+1),e},nearestMonth:function(t){var e=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1));return t.getUTCDate()>15&&e.setUTCMonth(e.getUTCMonth()+1),e},nearestDay:function(t){var e=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()));return t.getUTCHours()>12&&e.setUTCDate(e.getUTCDate()+1),e},nearestHour:function(){},nearestMinute:function(){},filter_multi_or:function(t,e){var i=!1;return t.every(function(t){var s=e[t];return void 0!==s&&s.selected&&(i=!0),!i}),i}};var CATID={FacetFilter:1,FacetSort:2,FacetScroll:3,FacetCollapse:4,ItemBased:5,Configuration:6,Other:7},ACTID_FILTER={CatValueAdd:1,CatValueRemove:2,CatValueExact:3,ClearOnSummary:4,ClearOnFacet:5,ClearAll:6,TimeMinHandle:7,TimeMaxHandle:8,TimeDragRange:9,TimeDot:10,CatTextSearch:11,MainTextSearch:12,ClearAllEscape:13},ACTID_SORT={ChangeSortFunc:1,ResortButton:2},ACTID_SCROLL={DragScrollbar:1,MouseScroll:2,ClickScrollbar:3,ScrollToTop:4,ClickMore:5},ACTID_COLLAPSE={Collapse:1,Show:2},ACTID_ITEM={Collapse:1,Show:2,FollowURL:3,FollowPDF:4},ACTID_CONFIG={WindowSize:1,Browser:2},ACTID_OTHER={DataSource:1,InfoButton:2,OpenPage:3,ClosePage:4,LeftPanelWidth:5,Resize:6};Tipsy.prototype={defaults:{className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",offset:0,offset_x:0,offset_y:0,opacity:.9},show:function(){var t=function(t,e){return"function"==typeof t?t.call(e):t},e=this.getTitle();if(e){var i=this.tip();i.find(".tipsy-inner").html(e),i[0].className="tipsy",i.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var s,a=$.extend({},this.jq_element.offset(),{width:this.jq_element[0].offsetWidth,height:this.jq_element[0].offsetHeight}),r=i[0].offsetWidth,o=i[0].offsetHeight,n=t(this.options.gravity,this.jq_element[0]);switch(n.charAt(0)){case"n":s={top:a.top+a.height+this.options.offset,left:a.left+a.width/2-r/2};break;case"s":s={top:a.top-o-this.options.offset,left:a.left+a.width/2-r/2};break;case"e":s={top:a.top+a.height/2-o/2,left:a.left-r-this.options.offset};break;case"w":s={top:a.top+a.height/2-o/2,left:a.left+a.width+this.options.offset}}s.top+=this.options.offset_y,s.left+=this.options.offset_x,2==n.length&&(s.left="w"==n.charAt(1)?a.left+a.width/2-15:a.left+a.width/2-r+15),i.css(s).addClass("tipsy-"+n),i.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+n.charAt(0),this.options.className&&i.addClass(t(this.options.className,this.jq_element[0])),this.options.fade?i.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity},200):i.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(200,function(){$(this).remove()}):this.tip().remove()},getTitle:function(){var t,t,e=this.jq_element,i=this.options,i=this.options;return"string"==typeof i.title?t=e.attr("title"==i.title?"original-title":i.title):"function"==typeof i.title&&(t=i.title.call(e[0])),t=(""+t).replace(/(^\s*|\s*$)/,""),t||i.fallback},tip:function(){return this.jq_tip?this.jq_tip:(this.jq_tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.jq_tip.data("tipsy-pointee",this.jq_element[0]),this.jq_tip)}},kshf.Item=function(t,e,i){this.data=t,this.idIndex=e,this.selected=!0,this.items=[],this.activeItems=0,this.barValue=0,this.barValueMax=0,i&&(this.filters=[!0],this.barCount=1,this.wanted=!0,this.mappedRows=[],this.mappedItems=[],this.mappedData=[!0],this.mappedDots=[],this.mappedAttribs=[],this.dirtyFilter=!0)},kshf.Item.prototype={id:function(){return this.data[this.idIndex]},setFilter:function(t,e){this.filters[t]!==e&&(this.filters[t]=e,this.dirtyFilter=!0)},updateSelected:function(){if(this.dirtyFilter){var t=this,e=this.wanted;this.wanted=!0,this.filters.every(function(e){return t.wanted=t.wanted&&e,t.wanted}),this.wanted===!0&&e===!1?(this.browser.itemsSelectedCt++,this.mappedRows.forEach(function(e){void 0!==e&&e!==!0&&e.forEach(function(e){e.activeItems++,e.barValue+=t.barCount,e.sortDirty=!0})}),this.mappedItems.forEach(function(t){t.activeItems++}),this.mappedDots.forEach(function(t){t.setAttribute("display","true")})):this.wanted===!1&&e===!0&&(this.browser.itemsSelectedCt--,this.mappedRows.forEach(function(e){void 0!==e&&e!==!0&&e.forEach(function(e){e.activeItems--,e.barValue-=t.barCount,e.sortDirty=!0})}),this.mappedItems.forEach(function(t){t.activeItems--}),this.mappedDots.forEach(function(t){t.setAttribute("display","false")})),this.dirtyFilter=!1}},updateSelected_SelectOnly:function(){this.wanted||this.updateSelected()},updateSelected_UnSelectOnly:function(){this.wanted&&this.updateSelected()},highlightTime:function(){this.mappedDots.forEach(function(t){t.setAttribute("highlight",!0)})},highlightAttribs:function(){this.mappedAttribs.forEach(function(t){t.setAttribute("highlight","true")})},highlightListItem:function(){void 0!==this.listItem&&this.listItem.setAttribute("highlight",!0)},highlightAll:function(){this.highlightTime(),this.highlightAttribs(),this.highlightListItem()},nohighlightTime:function(){this.mappedDots.forEach(function(t){t.setAttribute("highlight",!1)})},nohighlightAttribs:function(){this.mappedAttribs.forEach(function(t){t.setAttribute("highlight","false")})},nohighlightListItem:function(){this.listItem.setAttribute("highlight",!1)},nohighlightAll:function(){this.nohighlightTime(),this.nohighlightAttribs(),this.nohighlightListItem()}},kshf.Filter=function(t){this.isFiltered=!1,this.filterSummaryBlock=null,this.name=t.name,this.kshf_=t.kshf_,this.onClear=t.onClear,this.text_header=t.text_header,this.text_item=t.text_item,this.owner=t.owner,this.filterTitle=t.filterTitle,this.id=this.kshf_.maxFilterID++,this.clearFilter(!1),this.init=!0},kshf.Filter.prototype={addFilter:function(t){this.isFiltered=!0,this.refreshFilterSummary(),t===!0&&this.kshf_.update()},clearFilter:function(t){this.isFiltered&&(this.isFiltered=!1,this.kshf_.items.forEach(function(t){t.setFilter(this.id,!0)},this),void 0!==this.init&&(this.refreshFilterSummary(),this.onClear.call(this.owner),t===!0&&(this.kshf_.items.forEach(function(t){t.updateSelected_SelectOnly()}),this.kshf_.update())))},refreshFilterSummary:function(){var t=this;if(this.isFiltered)null===this.filterSummaryBlock&&(this.filterSummaryBlock=this.insertFilterSummaryBlock()),this.filterSummaryBlock.select(".chartClearFilterButton").on("click",function(){t.clearFilter(!0),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.ClearOnSummary,t.kshf_.getFilteringState(t.filterTitle))}),void 0!==this.text_header&&this.filterSummaryBlock.select(".txttt").text(this.text_header+": "),void 0!==this.text_item&&this.filterSummaryBlock.select(".filter_item").html(function(){return t.text_item.call(t.owner,t)});else{var e=this.filterSummaryBlock;if(null===e||void 0===e)return;e.attr("ready",!1),setTimeout(function(){e[0][0].parentNode.removeChild(e[0][0])},300),this.filterSummaryBlock=null}},insertFilterSummaryBlock:function(){var t;t=this.kshf_.listDisplay.dom.filterblocks.append("span").attr("class","filter-block"),t.append("span").attr("class","chartClearFilterButton summary").text("x").each(function(){this.tipsy=new Tipsy(this,{gravity:"n",fade:!0,opacity:1,title:function(){return"<span class='big'>x</span class='big'> <span class='action'>Remove</span> filter"}})}).on("mouseover",function(){this.tipsy.show()}).on("mouseout",function(){this.tipsy.hide(),d3.event.stopPropagation()});var e=t.append("span").attr("class","sdsdsds");return e.append("span").attr("class","txttt"),e.append("span").attr("class","filter_item"),window.getComputedStyle(t[0][0]).opacity,t.attr("ready",!0),t}},kshf.List=function(t,e,i){var s=this;this.itemtoggledetailsWidth=22,this.itemBarWidth_Max=50,this.parentKshf=t,this.dom={},this.linkFilterWidth=65,this.sortingOpts=e.sortingOpts,this.sortingOpts.forEach(function(e){void 0===e.value&&(e.value=t.columnAccessFunc(e.name)),e.label||(e.label=e.value),void 0===e.inverse&&(e.inverse=!1),void 0===e.func&&(e.func=s.getSortFunc(e.value))}),this.sortingOpt_Active=this.sortingOpts[0],this.sortingOpt_ActiveIndex=0,this.displayType="list","grid"===e.displayType&&(this.displayType="grid"),this.sortColWidth=e.sortColWidth,void 0!==e.textSearch&&(void 0===e.textSearchFunc&&(e.textSearchFunc=this.getKshf().columnAccessFunc(e.textSearch)),"*"===e.textSearch[0]&&(e.textSearch=e.textSearch.substring(1)),e.textSearch=e.textSearch.charAt(0).toLowerCase()+e.textSearch.slice(1)),void 0!==e.content&&(e.contentFunc=this.getKshf().columnAccessFunc(e.content)),this.hideTextSearch=void 0===e.textSearchFunc,this.contentFunc=e.contentFunc,this.itemLink=e.itemLink,this.itemLinkFunc=e.itemLinkFunc,this.itemLinkText=e.itemLinkText,void 0===this.itemLinkFunc&&void 0!==this.itemLink&&(this.itemLinkFunc=this.getKshf().columnAccessFunc(this.itemLink)),void 0!==this.itemLink&&(this.linkFilter=new kshf.Filter({name:"listItemLink",kshf_:this.getKshf(),onClear:this.clearFilter_Links,text_header:this.itemLink,text_item:this.textItemFunc,owner:this,filterTitle:"link"})),this.detailsToggle=e.detailsToggle,void 0===this.detailsToggle&&(this.detailsToggle="Off"),this.detailsDefault=e.detailsDefault,void 0===this.detailsDefault&&(this.detailsDefault=!1),"One"===this.detailsToggle&&(this.detailsDefault=!1),this.listDiv=i.append("div").attr("class","listDiv").attr("showAll",this.detailsDefault?"false":"true").attr("detailsToggle",this.detailsToggle);var a=this.listDiv.append("div").attr("class","listHeader");this.listDiv.append("div").attr("class","listItemGroup");var r=a.append("div").attr("class","topRow");this.dom.listColumnRow=a.append("div").attr("class","listColumnRow");var o=r.append("span").attr("class","listheader_count_wrap").style("width",s.sortColWidth+"px");if(o.append("span").attr("class","listheader_count_bar"),o.append("span").attr("class","listheader_count"),r.append("span").attr("class","listheader_itemName").html(this.getKshf().itemName),this.hideTextSearch!==!0){var n=r.append("span").attr("class","bigTextSearch_wrap");n.append("svg").attr("class","searchIcon").attr("width","13").attr("height","12").attr("viewBox","0 0 491.237793 452.9882813").attr("xmlns","http://www.w3.org/2000/svg").append("use").attr("xlink:href","#kshf_svg_search");var l=n.append("input").attr("class","bigTextSearch").attr("placeholder","Search "+(e.textSearch?e.textSearch:"title")).attr("autofocus","true");l.on("keydown",function(){this.timer&&(clearTimeout(this.timer),this.timer=null);var t=this;this.timer=setTimeout(function(){var i=t.value.toLowerCase();n.select("span").style("display",""===i?"none":"inline-block");var i=i.split(" ");s.getKshfItems().forEach(function(t){var s=!0;i.every(function(i){return s=s&&-1!==e.textSearchFunc(t).toLowerCase().indexOf(i)}),t.setFilter(0,s),t.updateSelected()}),s.getKshf().update(),t.timer=null,sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.MainTextSearch,s.getKshf().getFilteringState())},750)}),n.append("span").append("svg").attr("class","clearText").attr("width","15").attr("height","15").attr("viewBox","0 0 48 48").attr("xmlns","http://www.w3.org/2000/svg").append("use").attr("xlink:href","#kshf_svg_clearText").on("click",function(){l[0][0].value="",l[0][0].focus(),n.select("span").style("display","none"),s.getKshfItems().forEach(function(t){t.setFilter(0,!0),t.updateSelected()}),s.getKshf().update(),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.MainTextSearch,s.getKshf().getFilteringState())})}if(void 0!==this.itemLink&&this.insertItemLinkBar_Header(),this.sortFilters=[],"list"===this.displayType&&this.sortingOpts.forEach(function(t){s.sortFilters.push(new kshf.Filter({name:t.name,kshf_:s.getKshf(),onClear:s.clearFilter_Sort,text_header:t.name,text_item:s.textItemFunc_Sort,owner:this,filterTitle:"link"}))}),this.insertSortSelect(),this.insertItemsToggleDetails(),this.dom.filterblocks=this.dom.listColumnRow.append("span").attr("class","filter-blocks"),this.filteringItem=null,this.itemLink){var h=this.getKshfItems(),c=kshf.dt_id[this.getKshf().primaryTableName];h.forEach(function(t){var e=this.itemLinkFunc(t);if(void 0===e||""===e)e=null;else if(e instanceof Array){var i={};e=e.filter(function(t){return void 0===i[t]?(i[t]=!0,!0):!1})}t.mappedData[this.linkFilter.id]=e,t.items=[],e.forEach(function(e){var i=c[e];void 0!==i&&(i.items.push(t),i.activeItems++,t.mappedItems.push(i))}),t.selected=!1},this),this.linkFilter.clearFilter(!1)}this.sortItems(),this.insertItems()},kshf.List.prototype={getKshf:function(){return this.parentKshf},getKshfItems:function(){return this.parentKshf.items},insertItems:function(){var t=this;this.dom.listItems=this.listDiv.select(".listItemGroup").selectAll("div.listItem").data(void 0===this.contentFunc?[]:this.getKshfItems(),function(t){return t.id()}).enter().append("div").attr("class","listItem").attr("details",this.detailsDefault?"true":"false").attr("itemID",function(t){return t.id()}).each(function(t){t.listItem=this}).on("mouseover",function(t){d3.select(this).attr("highlight","true"),t.highlightAll()}).on("mouseout",function(t){d3.select(this).attr("highlight","false"),t.nohighlightAll()}),void 0!==this.itemLink&&this.insertItemLinkBar(),"list"===this.displayType&&(this.dom.listsortcolumn=this.dom.listItems.append("div").attr("class","listcell listsortcolumn").style("width",this.sortColWidth+"px").html(function(e){return t.sortingOpt_Active.label(e)}).each(function(e){this.columnValue=t.sortingOpt_Active.label(e)}).each(function(){this.tipsy=new Tipsy(this,{gravity:"s",fade:!0,opacity:1,title:function(){return"<span class='big'>+</span> <span class='action'>Add</span> <i>"+t.sortingOpt_Active.name+"</i> Filter"}})}).on("mouseover",function(){t.sortFilters[t.sortingOpt_ActiveIndex].isFiltered||this.tipsy.show()}).on("mouseout",function(){this.tipsy.hide()}).on("click",function(){t.sortFilters[t.sortingOpt_ActiveIndex].isFiltered||(this.tipsy.hide(),t.filterSortCol(this.columnValue))})),"Off"!==this.detailsToggle&&this.insertItemToggleDetails(),this.dom.listItems_Content=this.dom.listItems.append("div").attr("class","content").html(function(e){return t.contentFunc(e)})},insertSortSelect:function(){var t=this;return this.sortingOpts.length<2?(this.dom.listColumnRow.append("div").attr("class","listsortcolumn").style("width",this.sortColWidth+"px").text(this.sortingOpts[0].name),void 0):(this.dom.listColumnRow.append("select").attr("class","listSortOptionSelect").style("width",this.sortColWidth+5+"px").on("change",function(){t.sortingOpt_Active=t.sortingOpts[this.selectedIndex],t.sortingOpt_ActiveIndex=this.selectedIndex,t.sortItems(),t.reorderItemsOnDOM(),"list"===t.displayType&&t.dom.listsortcolumn.html(function(e){return t.sortingOpt_Active.label(e)}).each(function(e){this.columnValue=t.sortingOpt_Active.label(e)}),t.updateShowListGroupBorder()}).selectAll("input.list_sort_label").data(this.sortingOpts).enter().append("option").attr("class","list_sort_label").text(function(t){return t.name}),void 0)},insertItemToggleDetails:function(){var t=this.getKshf(),e=this.dom.listItems.append("div").attr("class","listcell itemtoggledetails").each(function(){this.tipsy=new Tipsy(this,{gravity:"s",fade:!0,className:"details",title:function(){return"Show details"}})});e.append("span").attr("class","item_details_on").html("[+]").on("click",function(e){t.showListItemDetails(e)}).on("mouseover",function(){this.parentNode.tipsy.options.title=function(){return"Show details"},this.parentNode.tipsy.show()}).on("mouseout",function(){this.parentNode.tipsy.hide()}),e.append("span").attr("class","item_details_off").html("[-]").on("click",function(e){t.hideListItemDetails(e)}).on("mouseover",function(){this.parentNode.tipsy.options.title=function(){return"Hide details"},this.parentNode.tipsy.show()}).on("mouseout",function(){this.parentNode.tipsy.hide()})},insertItemsToggleDetails:function(){if("Off"!==this.detailsToggle){var t=this,e=this.dom.listColumnRow.append("div").attr("class","itemtoggledetails");e.append("span").attr("class","items_details_on").html("[+]").attr("title","Show details").on("click",function(){t.dom.listItems.attr("details",!0),t.listDiv.attr("showAll","false")}),e.append("span").attr("class","items_details_off").html("[-]").attr("title","Hide details").on("click",function(){t.dom.listItems.attr("details",!1),t.listDiv.attr("showAll","true")})}},insertItemLinkBar_Header:function(){this.dom.listColumnRow.append("div").attr("class","itemLinks").style("width",this.linkFilterWidth+"px").append("span").attr("class","header").html(this.itemLink)},updateShowListGroupBorder:function(){var t=this,e=t.getKshfItems();if("list"===this.displayType)if(this.sortingOpt_Active.noGroupBorder===!0)this.dom.listItems.style("border-top-width","0px");else{var i=null,s=this.sortingOpt_Active.value,a=this.sortingOpt_Active.func;e.forEach(function(t){t.wanted&&(null!==i&&void 0!==t.listItem&&(t.listItem.style.borderTopWidth=0!==a(s(t),s(i))?"4px":"0px"),i=t)})}},reorderItemsOnDOM:function(){this.dom.listItems.data(this.getKshfItems(),function(t){return t.id()}).order()},sortItems:function(){var t=this.sortingOpt_Active.value,e=this.sortingOpt_Active.func,i=this.sortingOpt_Active.inverse;this.getKshfItems().sort(function(s,a){if(!s.wanted||!a.wanted)return 0;var r=e(t(s),t(a));return 0===r&&(r=a.id()-s.id()),i&&(r=-r),r})},getSortFunc:function(t){for(var e,i,s,a=0,s=0;!0;a++){if(3===s||a===this.getKshfItems().length){e=i;break}var r,o=this.parentKshf.items[a],n=t(o);switch(typeof n){case"string":r=kshf.Util.sortFunc_List_String;break;case"number":r=kshf.Util.sortFunc_List_Number;break;case"object":r=n instanceof Date?kshf.Util.sortFunc_List_Date:kshf.Util.sortFunc_List_Number;break;default:r=kshf.Util.sortFunc_List_Number}r===i?s++:(i=r,s=0)}return e},updateItemVisibility:function(){var t=this,e="list"===this.displayType?"block":"inline-block";this.dom.listItems.style("display",function(t){return t.wanted?e:"none"}),this.listDiv.select(".listheader_count").text(function(){return 0===t.getKshf().itemsSelectedCt?"No":t.getKshf().itemsSelectedCt}),this.listDiv.select(".listheader_count_bar").transition().style("width",function(){return t.getKshf().listDisplay.sortColWidth*t.getKshf().itemsSelectedCt/t.getKshfItems().length+"px"})},updateContentWidth:function(t){"Off"!==this.detailsToggle&&(t-=this.itemtoggledetailsWidth),t-=this.sortColWidth,void 0!==this.itemLink&&(t-=this.linkFilterWidth),t-=12,this.dom.filterblocks.style("width",t+"px"),"list"===this.displayType&&this.dom.listItems_Content.style("width",t+"px")},insertItemLinkBar:function(){var t=this,e=this.dom.listItems.append("div").attr("class","listcell itemLinks").style("width",this.linkFilterWidth+"px").each(function(){this.tipsy=new Tipsy(this,{gravity:"s",fade:!0,className:"details",title:function(){return"<span class='big'>+</span> <span class='action'>Add</span> <i>"+t.itemLink+"</i> Filter"}})}).on("click",function(e){0!==e.activeItems&&(this.tipsy.hide(),t.filterLinks(e))}).on("mouseover",function(){this.tipsy.show()}).on("mouseout",function(){this.tipsy.hide()}).append("span").attr("class","captureEvents");this.dom.listItems_itemLinks_captureEvents=e,this.dom.listItems_itemLinks_itemCount=e.append("span").attr("class","itemCount"),this.dom.listItems_itemLinks_itemBar=e.append("span").attr("class","itemBar"),this.updateItemLinks()},updateItemLinks:function(){var t=this,e=this.getKshf();this.linkBarAxisScale=d3.scale.linear().domain([0,this.getMaxBarValuePerItem()]).rangeRound([0,this.itemBarWidth_Max]),this.dom.listItems_itemLinks_captureEvents.attr("count",function(t){return t.activeItems}),this.dom.listItems_itemLinks_itemCount.text(function(t){return t.activeItems}),this.dom.listItems_itemLinks_itemBar.transition().duration(e.anim_layout_duration).style("width",function(e){return t.linkBarAxisScale(e.activeItems)+"px"})},getMaxBarValuePerItem:function(){var t=this.itemLinkFunc;return d3.max(this.getKshfItems(),function(e){return null===t(e)?null:e.activeItems})},updateAfterFiltering:function(){this.updateItemVisibility(),this.updateShowListGroupBorder(),void 0!==this.itemLink},getFilteredCount:function(){var t=0;return this.hideTextSearch!==!0&&""!==this.listDiv.select("input.bigTextSearch")[0][0].value&&t++,t+=null!==this.filteringItem?1:0,this.sortFilters.forEach(function(e){t+=e.isFiltered?1:0}),t},isFiltered_Link:function(){return null!==this.filteringItem},filterLinks:function(t){t.selected=!t.selected;var e=this.linkFilter.id,i=kshf.dt_id[this.getKshf().primaryTableName];this.filteringItem&&(this.filteringItem.selected=!1),this.filteringItem=t,this.getKshfItems().forEach(function(t){var s=t.mappedData[e],a=!1;void 0!==s&&null!==s&""!==s&&(a=s instanceof Array?kshf.Util.filter_multi_or.call(this,s,i):i[s].selected),t.setFilter(e,a),t.updateSelected()}),this.linkFilter.addFilter(!0)},filterSortCol:function(t){var e=this.sortingOpt_Active.label,i=this.sortFilters[this.sortingOpt_ActiveIndex],s=i.id;this.getKshfItems().forEach(function(i){i.setFilter(s,e(i)===t),i.updateSelected()}),i.value=t,i.addFilter(!0)},clearFilters_All:function(){void 0!==this.linkFilter&&this.linkFilter.clearFilter(!1),this.sortFilters.forEach(function(t){t.clearFilter(!1)})},clearFilter_Links:function(){null!==this.filteringItem&&(this.filteringItem.selected=!1,this.filteringItem=null,this.linkFilter.clearFilter(!0))},clearFilter_Sort:function(){},textItemFunc:function(){return"<b>"+this.itemLinkText(this.filteringItem)+"</b>"},textItemFunc_Sort:function(t){return"<b>"+t.value+"</b>"}},kshf.Browser=function(t){var e=this;this.chartTitle=t.chartTitle,this.charts=[],this.maxFilterID=1,this.barMaxWidth=0,this.scrollPadding=5,this.scrollWidth=10,this.sepWidth=10,this.filters=[],this.anim_barscale_duration_default=400,this.anim_layout_duration=600,this.anim_layout_delay=300,this.categoryTextWidth=t.categoryTextWidth,void 0===this.categoryTextWidth&&(this.categoryTextWidth=115),"number"==typeof t.barChartWidth&&(this.barChartWidth=t.barChartWidth),this.chartDefs=t.charts,this.listDef=t.list,this.primItemCatValue=null,"string"==typeof t.catValue&&(this.primItemCatValue=t.catValue),this.listMaxColWidthMult=t.listMaxColWidthMult?t.listMaxColWidthMult:.25,this.line_height=t.line_height,void 0===this.line_height&&(this.line_height=18),this.domID=t.domID,this.source=t.source,this.source.loadedTableCount=0,this.loadedCb=t.loadedCb,this.readyCb=t.readyCb,this.updateCb=t.updateCb,this.dom={},this.skipFacet={},t.columnsSkip&&t.columnsSkip.forEach(function(t){this.skipFacet[t]=!0},this),this.itemName=void 0!==t.itemName?t.itemName:this.source.sheets[0].name,this.dirRoot=t.dirRoot,void 0===this.dirRoot&&(this.dirRoot="./"),this.showDataSource=!0,void 0!==t.showDataSource&&(this.showDataSource=t.showDataSource),this.forceHideBarAxis=!1,void 0!==t.forceHideBarAxis&&(this.forceHideBarAxis=t.forceHideBarAxis),this.root=d3.select(this.domID).classed("kshfHost",!0).attr("tabindex","1").style("position","relative").style("overflow-y","hidden").on("keydown",function(){var t=d3.event;27===t.keyCode&&(e.clearFilters_All(),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.ClearAllEscape,this.getFilteringState()))}),t.showResizeCorner===!0&&this.insertResize(),kshf.num_of_browsers++,1==kshf.num_of_browsers&&this.insertGradients(),this.insertInfobox(),void 0!==this.chartTitle&&this.insertBrowserHeader();var i=this.root.append("div").attr("class","subRoot");this.layoutBackground=i.append("div").attr("class","kshf layout_left_background"),this.layoutTop=i.append("div").attr("class","kshf layout_top"),this.layoutLeft=i.append("div").attr("class","kshf layout_left"),this.layoutRight=i.append("div").attr("class","kshf layout_right"),this.loadSource()},kshf.Browser.prototype={createFilter:function(t){var e=new kshf.Filter(t);return this.filters.push(e),e},insertResize:function(){var t=this;this.root.append("div").attr("class","kshf layout_resize").on("mousedown",function(){t.root.style("cursor","nwse-resize");var e=d3.mouse(d3.select("body")[0][0])[0],i=d3.mouse(d3.select("body")[0][0])[1],s=parseInt(d3.select(this.parentNode).style("width")),a=parseInt(d3.select(this.parentNode).style("height"));d3.select("body").on("mousemove",function(){var r=d3.mouse(d3.select("body")[0][0])[0]-e,o=d3.mouse(d3.select("body")[0][0])[1]-i;d3.select(t.domID).style("height",a+o+"px"),d3.select(t.domID).style("width",s+r+"px"),t.updateLayout()}).on("mouseup",function(){sendLog&&sendLog(CATID.Other,ACTID_OTHER.Resize),t.root.style("cursor","default"),d3.select("body").on("mousemove",null).on("mouseup",null)}),d3.event.preventDefault()})},insertGradients:function(){var t="#dadada",e=this.root.append("svg").attr("width",0).attr("height",0).append("defs"),i="#616F7A",s="#CCCCCC";e.append("symbol").attr("id","kshf_svg_search").attr("viewbox","0 0 491.237793 452.9882813").html('<g fill-rule="nonzero" clip-rule="nonzero" fill="#0F238C" stroke="#cb5454" stroke-miterlimit="4"><g fill-rule="evenodd" clip-rule="evenodd"><path fill="#cb5454" id="path3472" d="m328.087402,256.780273c-5.591797,8.171875 -13.280273,17.080078 -22.191406,25.296875c-9.685547,8.931641 -20.244141,16.550781 -27.433594,20.463867l163.125977,150.447266l49.649414,-45.783203l-163.150391,-150.424805z"/><path fill="#cb5454" id="path3474" d="m283.82959,45.058109c-65.175781,-60.07764 -169.791023,-60.07764 -234.966309,0c-65.150881,60.100582 -65.150881,156.570309 0,216.671383c65.175285,60.100586 169.790527,60.100586 234.966309,0c65.175781,-60.101074 65.175781,-156.570801 0,-216.671383zm-34.198242,31.535152c-46.204102,-42.606934 -120.390625,-42.606934 -166.570305,0c-46.204594,42.583496 -46.204594,110.994141 0,153.601074c46.17968,42.606445 120.366203,42.606445 166.570305,0c46.205078,-42.606934 46.205078,-111.017578 0,-153.601074z"/></g></g>'),e.append("symbol").attr("id","kshf_svg_clearText").attr("viewbox","0 0 48 48").html('<g><path type="arc" style="fill-opacity:1;" cx="24" cy="24" rx="22" ry="22" d="M 46 24 A 22 22 0 1 1  2,24 A 22 22 0 1 1  46 24 z"/><path nodetypes="cc" style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#ffffff;stroke-width:6;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 16.221825,16.221825 L 31.778175,31.778175"/><path nodetypes="cc" d="M 31.778175,16.221825 L 16.221825,31.778175" style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#ffffff;stroke-width:6;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"/></g>');var a=e.append("linearGradient").attr("id","gr_rowSelectBackground_Count").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");a.append("stop").attr("offset","0%").style("stop-color",t).style("stop-opacity",1),a.append("stop").attr("offset","100%").style("stop-color",t).style("stop-opacity",0),a=e.append("linearGradient").attr("id","gr_rowSelectBackground_Label").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),a.append("stop").attr("offset","0%").style("stop-color",t).style("stop-opacity",0),a.append("stop").attr("offset","20%").style("stop-color",t).style("stop-opacity",1),a.append("stop").attr("offset","100%").style("stop-color",t).style("stop-opacity",1),a=e.append("radialGradient").attr("id","dotGradient50").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),a.append("stop").attr("offset","0%").style("stop-color",i).style("stop-opacity",.4),a.append("stop").attr("offset","25%").style("stop-color",i).style("stop-opacity",.4),a.append("stop").attr("offset","100%").style("stop-color",i).style("stop-opacity",.3),a=e.append("radialGradient").attr("id","dotGradient75").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),a.append("stop").attr("offset","0%").style("stop-color",i).style("stop-opacity",.6),a.append("stop").attr("offset","25%").style("stop-color",i).style("stop-opacity",.6),a.append("stop").attr("offset","100%").style("stop-color",i).style("stop-opacity",.5),a=e.append("radialGradient").attr("id","dotGradient25").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),a.append("stop").attr("offset","0%").style("stop-color",i).style("stop-opacity",.25),a.append("stop").attr("offset","25%").style("stop-color",i).style("stop-opacity",.25),a.append("stop").attr("offset","100%").style("stop-color",i).style("stop-opacity",.2),a=e.append("radialGradient").attr("id","dotGradient100").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),a.append("stop").attr("offset","0%").style("stop-color",i).style("stop-opacity",.85),a.append("stop").attr("offset","25%").style("stop-color",i).style("stop-opacity",.85),a.append("stop").attr("offset","100%").style("stop-color",i).style("stop-opacity",.7),a=e.append("radialGradient").attr("id","dotGradient_Inactive").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),a.append("stop").attr("offset","0%").style("stop-color",s).style("stop-opacity",1),a.append("stop").attr("offset","25%").style("stop-color",s).style("stop-opacity",1),a.append("stop").attr("offset","100%").style("stop-color",s).style("stop-opacity",0)},insertInfobox:function(){var t=this,e="";e+="<div align='center'>",e+="<div class='header'>Browser created by <span class='libName'>Keshif</span> library</div>",e+="<div align='center' class='boxinbox project_credits'>",e+=" Developed by:<br/>",e+="<div style='float:right;'>",e+="<iframe src='http://ghbtns.com/github-btn.html?user=adilyalcin&repo=Keshif&type=watch&count=true' allowtransparency='true' frameborder='0' scrolling='0' width='90px' height='20px'></iframe><br/>",e+="<iframe src='http://ghbtns.com/github-btn.html?user=adilyalcin&repo=Keshif&type=fork&count=true' allowtransparency='true' frameborder='0' scrolling='0' width='90px' height='20px'></iframe>",e+="</div>",e+=" <a href='http://www.adilyalcin.me' target='_blank'><img src='"+this.dirRoot+"img/credit-1_01.png' style='height:50px'></a>",e+=" <img src='"+this.dirRoot+"img/credit-1_02.png' style='height:50px; padding:0px 4px 0px 4px'>",e+=" <a href='http://www.cs.umd.edu/hcil/' target='_blank'><img src='"+this.dirRoot+"img/credit-1_03.png' style='height:50px'></a>",e+=" <img src='"+this.dirRoot+"img/credit-1_04.png' style='height:50px;padding:0px 4px 0px 4px'>",e+=" <a href='http://www.umd.edu' target='_blank'><img src='"+this.dirRoot+"img/credit-1_05.png' style='height:50px'></a>",e+="</div>",e+="",e+="<div align='center' class='boxinbox project_credits'>",e+=" 3rd party libraries and APIs used:<br/>",e+=" <a href='http://d3js.org/' target='_blank'>D3</a> -",e+=" <a href='http://jquery.com' target='_blank'>JQuery</a> -",e+=" <a href='https://developers.google.com/chart/' target='_blank'>Google Charts</a>",e+="</div><br/>",e+="",e+="<div align='center' class='project_fund'>",e+="Keshif (<a target='_blank' href='http://translate.google.com/#auto/en/ke%C5%9Fif'><i>keşif</i></a>) means discovery / exploration in Turkish.<br/>",e+="Funded in part by <a href='http://www.huawei.com'>Huawei</a>. </div>",e+="",this.layout_infobox=this.root.append("div").attr("class","kshf layout_infobox"),this.layout_infobox.append("div").attr("class","infobox_background").on("click",function(){t.layout_infobox.style("display","none"),t.layout_infobox.select("div.infobox_credit").style("display","none"),t.layout_infobox.select("div.infobox_datasource").style("display","none")
}),this.dom.loadingBox=this.layout_infobox.append("div").attr("class","infobox_content infobox_loading"),this.dom.loadingBox.append("img").attr("class","status").attr("src",this.dirRoot+"img/loading.gif");var i=this.dom.loadingBox.append("div").attr("class","status_text");i.append("span").text("Loading..."),i.append("div").text(void 0!==this.source.sheets?"("+this.source.loadedTableCount+"/"+this.source.sheets.length+")":"");var s=this.layout_infobox.append("div").attr("class","infobox_content infobox_credit");s.append("div").attr("class","infobox_close_button").text("x").on("click",function(){t.layout_infobox.style("display","none"),t.layout_infobox.select("div.infobox_credit").style("display","none"),t.layout_infobox.select("div.infobox_datasource").style("display","none")}),s.append("div").attr("class","all-the-credits").html(e);var a=this.layout_infobox.append("div").attr("class","infobox_content infobox_datasource").text("Datasource files:");a.append("div").attr("class","infobox_close_button").text("x").on("click",function(){t.layout_infobox.style("display","none"),t.layout_infobox.select("div.infobox_credit").style("display","none"),t.layout_infobox.select("div.infobox_datasource").style("display","none")});var r=a.append("ul");this.showDataSource&&void 0===this.source.gDocId&&r.selectAll("li").data(this.source.sheets,this._dataMap).enter().append("li").append("a").attr("target","_blank").attr("href",function(e){return t.source.dirPath+e.name+"."+t.source.fileType}).text(function(e){return e.name+"."+t.source.fileType})},insertBrowserHeader:function(){var t=this;this.layoutHeader=this.root.append("div").attr("class","kshf layout_header");var e=this.root.select(".layout_header").append("div").attr("class","filter_header").style("height",this.line_height-3+"px");e.append("span").attr("class","leftBlockAdjustSize").attr("title","Drag to adjust panel width").style("height",this.line_height-4+"px").on("mousedown",function(){t.root.style("cursor","ew-resize");var e=d3.mouse(this.parentNode.parentNode)[0],i=t.width_leftPanel_bar;t.root.on("mousemove",function(){var s=d3.mouse(this)[0],a=s-e;t.anim_barscale_duration=0,t.anim_layout_duration=0,t.setBarWidthLeftPanel(i+a),t.updateLayout(),t.anim_layout_duration=600}).on("mouseup",function(){sendLog&&sendLog(CATID.Other,ACTID_OTHER.LeftPanelWidth,{panelWidth:t.width_leftPanel_bar}),t.root.style("cursor","default"),t.root.on("mousemove",null).on("mouseup",null)}),d3.event.preventDefault()}).on("click",function(){d3.event.stopPropagation(),d3.event.preventDefault()});var i=e.append("span").attr("class","left_align").style("width",this.categoryTextWidth+"px");i.append("span").attr("class","filters_text").text("Filters:");var s=i.append("span").attr("class","filter-block-clear").attr("filtered_row","false").text("Clear");s.append("div").attr("class","chartClearFilterButton allFilter").text("x").on("click",function(){t.clearFilters_All()}).each(function(){this.tipsy=new Tipsy(this,{gravity:"n",fade:!0,opacity:1,title:function(){return"<span class='big'>x</span class='big'> <span class='action'>Remove</span> all filtering"}})}).on("mouseover",function(){this.tipsy.show()}).on("mouseout",function(){this.tipsy.hide(),d3.event.stopPropagation()}),e.append("span").attr("class","barChartMainInfo").text(null===this.primItemCatValue?"⇒Item Count ":"⇒Total "+this.primItemCatValue).append("span").attr("class","refreshbarscales").attr("width","13").append("svg").attr("viewBox","0 -256 1792 1792").attr("width","13px").attr("height","100%").append("g").attr("transform","matrix(1,0,0,-1,121.49153,1270.2373)").append("path").style("fill","currentColor").attr("d","m 1511,480 q 0,-5 -1,-7 Q 1446,205 1242,38.5 1038,-128 764,-128 618,-128 481.5,-73 345,-18 238,84 L 109,-45 Q 90,-64 64,-64 38,-64 19,-45 0,-26 0,0 v 448 q 0,26 19,45 19,19 45,19 h 448 q 26,0 45,-19 19,-19 19,-45 0,-26 -19,-45 L 420,266 q 71,-66 161,-102 90,-36 187,-36 134,0 250,65 116,65 186,179 11,17 53,117 8,23 30,23 h 192 q 13,0 22.5,-9.5 9.5,-9.5 9.5,-22.5 z m 25,800 V 832 q 0,-26 -19,-45 -19,-19 -45,-19 h -448 q -26,0 -45,19 -19,19 -19,45 0,26 19,45 l 138,138 Q 969,1152 768,1152 634,1152 518,1087 402,1022 332,908 321,891 279,791 271,768 249,768 H 50 Q 37,768 27.5,777.5 18,787 18,800 v 7 q 65,268 270,434.5 205,166.5 480,166.5 146,0 284,-55.5 138,-55.5 245,-156.5 l 130,129 q 19,19 45,19 26,0 45,-19 19,-19 19,-45 z"),this.layoutHeader.append("div").attr("title","Show Info & Credits").attr("class","credits").on("click",function(){t.showInfoBox()}).text("i"),this.showDataSource!==!1&&this.layoutHeader.append("div").style("float","right").style("margin","2px").on("click",function(){t.source.gdocId?window.open("https://docs.google.com/spreadsheet/ccc?key="+t.source.gdocId,"_blank"):(t.layout_infobox.style("display","block"),t.layout_infobox.style("display","block")),sendLog&&sendLog(CATID.Other,ACTID_OTHER.DataSource)}).append("img").attr("class","datasource").attr("title","Open Data Source").attr("src",this.dirRoot+"img/datasource.png"),this.layoutHeader.append("span").attr("class","title").text(this.chartTitle)},showInfoBox:function(){sendLog&&sendLog(CATID.Other,ACTID_OTHER.InfoButton),this.layout_infobox.style("display","block"),this.layout_infobox.select(".infobox_credit").style("display","block")},loadSource:function(){return this.source.callback?(this.source.callback(this),void 0):(this.source.sheets[0].primary=!0,this.primaryTableName=this.source.sheets[0].name,this.source.sheets.forEach(function(t){void 0===t.id&&(t.id="id"),void 0===t.tableName&&(t.tableName=t.name),this.source.gdocId?this.loadSheet_Google(t):this.source.dirPath?this.loadSheet_File(t):t.data&&this.loadSheet_Memory(t)},this),void 0)},loadSheet_Google:function(t){var e=this,i=kshf.queryURL_base+this.source.gdocId+"&headers=1";i+=t.sheetID?"&gid="+t.sheetID:"&sheet="+t.name,t.range&&(i+="&range="+t.range);var s=new google.visualization.Query(i);t.query&&s.setQuery(t.query),s.send(function(i){if(i.isError())return this.layout_infobox.select("div.status_text span").text("Cannot load data"),this.layout_infobox.select("img").attr("src",e.dirRoot+"img/alert.png").style("height","40px"),this.layout_infobox.select("div.status_text div").text("("+i.getMessage()+")"),void 0;var s,a,r,o=[],n=-1,l=0,h=i.getDataTable(),c=h.getNumberOfColumns();for(r=0;!0;r++)if(r===c||h.getColumnLabel(r).trim()===t.id){n=r;break}for(o.length=h.getNumberOfRows(),a=0;a<h.getNumberOfRows();a++){var d=[];for(d.length=c,r=0;c>r;r++)d[r]=h.getValue(a,r);n===c&&d.push(l++),o[a]=new kshf.Item(d,n,t.primary),o[a].browser=e}for(kshf.createColumnNames(t.tableName),s=0;s<h.getNumberOfColumns();s++)kshf.insertColumnName(t.tableName,h.getColumnLabel(s).trim(),s);e.finishDataLoad(t,o)})},loadSheet_File:function(t){var e=this,i=this.source.dirPath+t.name+"."+this.source.fileType;$.ajax({url:i,type:"GET",contentType:"text/csv",success:function(i){var s,a,r=i.split(/\r\n|\r|\n/g);if(!(r.length<2)){kshf.createColumnNames(t.tableName);var o=[],n=-1,l=0;for(s=0;s<r.length;s++){var h;if("csv"===e.source.fileType?h=r[s].split(","):"tsv"===e.source.fileType&&(h=r[s].split("	")),h=kshf.Util.unescapeCommas(h),0===s){for(a=0;a<h.length;a++){var c=h[a];kshf.insertColumnName(t.tableName,c,a),c===t.id&&(n=a)}-1===n&&(kshf.insertColumnName(t.tableName,t.id,a),n=a)}else{n===h.length&&h.push(l++);var d=new kshf.Item(h,n,t.primary);d.browser=e,o.push(d)}}e.finishDataLoad(t,o)}}})},loadSheet_Memory:function(t){var e,i=[],s=-1,a=0;this.createColumnNames(t.tableName),t.data.forEach(function(r,o){0===o?(r.forEach(function(e,i){kshf.insertColumnName(t.tableName,e,i),e===t.id&&(s=i)}),-1===s&&(kshf.insertColumnName(t.tableName,t.id,e),s=e)):(s===r.length&&r.push(a++),i.push(new kshf.Item(r,s,t.primary)))}),this.finishDataLoad(t,i)},createTableFromTable:function(t,e,i){var s=0,a=this;kshf.dt_id[e]={},kshf.dt[e]=[];var r=kshf.dt_id[e],o=kshf.dt[e];t.forEach(function(t){var e=i(t);if(""!==e&&void 0!==e&&null!==e)if(e instanceof Array)e.forEach(function(t){if(""!==t&&void 0!==t&&null!==t&&!r[t]){var e=new kshf.Item([s++,t],0);e.browser=a,r[t]=e,o.push(e)}});else if(!r[e]){var n=new kshf.Item([s++,e],0);n.browser=a,r[e]=n,o.push(n)}})},finishDataLoad:function(t,e){kshf.dt[t.tableName]=e,t.primary&&(this.items=e,this.itemsSelectedCt=e.length);var i={};e.forEach(function(t){i[t.id()]=t}),kshf.dt_id[t.tableName]=i,this.incrementLoadedSheetCount()},incrementLoadedSheetCount:function(){var t=this;if(this.source.loadedTableCount++,this.layout_infobox.select("div.status_text div").text("("+this.source.loadedTableCount+"/"+this.source.sheets.length+")"),this.source.loadedTableCount===this.source.sheets.length){var e=kshf.dt[this.primaryTableName],i=kshf.dt_ColNames[this.primaryTableName][this.primItemCatValue];"string"==typeof this.primItemCatValue&&e.forEach(function(t){t.barCount=t.data[i]}),this.layout_infobox.select("div.status_text span").text("Creating Keshif browser"),this.layout_infobox.select("div.status_text div").text(""),window.setTimeout(function(){t.loadCharts()},50)}},loadCharts:function(){var t=this;if(void 0!==this.loadedCb&&this.loadedCb(),void 0===this.chartDefs){this.chartDefs=[];var e=kshf.dt_ColNames_Arr[this.primaryTableName];e.forEach(function(t){t!==this.source.sheets[0].id&&this.skipFacet[t]!==!0&&"*"!==t[0]&&this.chartDefs.push({facetTitle:t})},this)}this.chartDefs.forEach(function(e){t.addBarChart(e)}),this.charts.forEach(function(t){t.init_DOM()}),this.listDisplay=new kshf.List(this,this.listDef,this.layoutRight),this.loaded=!0,this.updateLayout(),this.update(),this.layout_infobox.style("display","none"),this.dom.loadingBox.style("display","none"),void 0!==this.readyCb&&this.readyCb()},addBarChart:function(t){t.layout=void 0!==t.timeTitle?this.layoutTop:this.layoutLeft,void 0===t.catTableName&&(t.catTableName=this.primaryTableName,t.generateRows=!0),void 0===t.sortingOpts&&(t.sortingOpts=[{}]),t.rowTextWidth=this.categoryTextWidth,this.charts.push(new kshf.BarChart(this,t))},columnAccessFunc:function(t){var e=this.primaryTableName,i=kshf.dt_ColNames[e][t];return function(t){return t.data[i]}},getRowLabelOffset:function(){if(!this._labelXOffset){var t=d3.max(this.charts,function(t){return t.getMaxBarValueMaxPerAttrib()});this._labelXOffset=12;for(var e=1;t>9;)e++,t=Math.floor(t/10);e>4&&(e=4),this._labelXOffset+=6*e}return this._labelXOffset},getRowTotalTextWidth:function(){return this.categoryTextWidth+this.getRowLabelOffset()},domHeight:function(){return parseInt(d3.select(this.domID).style("height"))},domWidth:function(){return parseInt(d3.select(this.domID).style("width"))},filterFacetAttribute:function(t,e){var i=this.charts[t];i.filterAttrib(i.getAttribs()[e])},clearFilters_All:function(){this.charts.forEach(function(t){t.clearFilters_All()}),this.listDisplay.clearFilters_All(),this.items.forEach(function(t){t.updateSelected_SelectOnly()}),this.update()},update:function(){var t=this,e=0;void 0===this.firsttimeupdate&&(this.items.forEach(function(t){t.updateSelected()}),this.firsttimeupdate=!0),this.anim_barscale_duration=this.anim_barscale_duration_default,this.listDisplay&&(this.listDisplay.updateAfterFiltering(),e+=this.listDisplay.getFilteredCount()),this.charts.forEach(function(t){t.refreshUI(),e+=t.getFilteredCount()}),setTimeout(function(){t.updateLayout_Height()},800),this.root.select(".filter-block-clear").style("display",e>0?"inline-block":"none"),this.listDisplay.dom.filterblocks.style("display",e>0?"inline-block":"none"),this.updateCb&&this.updateCb()},updateLayout_Height:function(){var t=22,e=this.domHeight();void 0!==this.chartTitle&&(e-=t),this.layoutBackground.style("height",e+"px"),this.divWidth=this.domWidth();var i=Math.floor(e/this.line_height),s=0,a=[],r=0,o=-1;this.charts.forEach(function(t){"barChart"===t.type&&s++,a.push(!1)});var n=i,l=e,h=this.charts[0];if("scatterplot"===h.type)if(n>15){var c=Math.ceil(n/4);h.setRowCount_VisibleAttribs(c-h.rowCount_Header()-1);var d=h.rowCount_Total_Right();n-=d,l-=this.line_height*d,a[0]=!0}else h.collapsedTime=!0,n--,l-=1*this.line_height;var u=parseInt(this.root.select(".listHeader").style("height"));this.root.select(".listItemGroup").transition().duration(this.anim_layout_duration).style("height",l-u-15+"px"),n=i,this.charts.forEach(function(t,e){"scatterplot"===t.type&&a[e]===!0&&(n-=t.rowCount_Total())});for(var p=!1;s>r;){o=r;var m=Math.floor(n/(s-r));this.charts.forEach(function(t,e){if(!a[e]){if(n<t.rowCount_MinTotal())return t.divRoot.style("display","none"),a[e]=!0,r++,t.hidden=!0,void 0;if(t.collapsedTime);else if(t.options.catDispCountFix)t.setRowCount_VisibleAttribs(t.options.catDispCountFix);else if(t.rowCount_MaxTotal()<=m)t.setRowCount_VisibleAttribs(t.attribCount_Active);else{if(!p)return;t.setRowCount_VisibleAttribs(m-t.rowCount_Header()-1)}(void 0===t.hidden||t.hidden===!0)&&(t.hidden=!1,t.divRoot.style("display","block")),n-=t.rowCount_Total(),a[e]=!0,r++}}),p=o===r}for(var f=!1;n>0&&!f;)f=!0,this.charts.every(function(t){if(t.hidden)return!0;if(t.collapsed)return!0;if(t.allAttribsVisible())return!0;if(void 0!==t.options.catDispCountFix)return!0;if("scatterplot"===t.type&&t.collapsedTime===!1)return!0;var e=n;return n+=t.rowCount_Total(),t.setRowCount_VisibleAttribs(t.rowCount_Visible+1),n-=t.rowCount_Total(),e!==n&&(f=!1),n>0});this.charts.forEach(function(t){t.refreshVisibleAttribs()}),"scatterplot"===h.type&&this.layoutRight.transition().duration(this.anim_layout_duration).style("top",h.rowCount_Total_Right()*this.line_height+"px"),this.layoutLeft.transition().duration(this.anim_layout_duration).style("top",("scatterplot"===h.type?h.rowCount_Total()*this.line_height:0)+"px")},updateLayout:function(){if(this.loaded===!0){this.divWidth=this.domWidth(),this.anim_barscale_duration=this.anim_barscale_duration_default;var t=this.width_leftPanel_bar;void 0===this.width_leftPanel_bar?t=void 0===this.barChartWidth?Math.floor((this.divWidth-this.categoryTextWidth)/11):this.barChartWidth:void 0!==this.barChartWidth&&(t=this.barChartWidth),this.anim_barscale_duration=0,this.setHideBarAxis(t),this.updateLayout_Height(),this.setBarWidthLeftPanel(t),this.updateAllTheWidth()}},setCategoryTextWidth:function(t){this.categoryTextWidth=t,this.charts.forEach(function(e){("barChart"===e.type||"scatterplot"===e.type)&&(e.options.rowTextWidth=t,e.refreshTextWidth(t),e.updateBarWidth())}),this.updateAllTheWidth()},setHideBarAxis:function(t){t>200?(this.hideBars=!1,this.hideBarAxis=!1):t>45?(this.hideBars=!1,this.hideBarAxis=!1):t>10?(this.hideBars=!1,this.hideBarAxis=!0):(this.hideBars=!0,this.hideBarAxis=!0,t=0),this.forceHideBarAxis===!0&&(this.hideBarAxis=!0),this.width_leftPanel_bar=t,this.hideBars===!1?this.root.attr("hidebars",!1):this.root.attr("hidebars",!0),this.hideBarAxis===!1?this.root.attr("hideBarAxis",!1):this.root.attr("hideBarAxis",!0)},setBarWidthLeftPanel:function(t){this.setHideBarAxis(t),this.barMaxWidth!==this.width_leftPanel_bar&&(this.barMaxWidth=this.width_leftPanel_bar,this.charts.forEach(function(t){t.updateBarAxisScale(),t.refreshWidth_Bars_Active(),t.refreshUIWidth()}))},fullWidthResultSet:function(){return 1==this.charts.length&&"scatterplot"===this.charts[0].type},updateAllTheWidth:function(){this.width_leftPanel_total=this.getRowTotalTextWidth()+this.width_leftPanel_bar+this.scrollWidth+this.scrollPadding+2;var t=this.divWidth-this.width_leftPanel_total-this.scrollPadding-15;if(this.layoutBackground.style("width",this.width_leftPanel_total+"px"),this.root.select("div.filter_header").style("width",this.width_leftPanel_total-8+"px"),this.layoutRight.style("left",(this.fullWidthResultSet()?0:this.width_leftPanel_total)+"px"),this.charts.forEach(function(e){"scatterplot"===e.type&&e.setTimeWidth(t)}),this.listDisplay){this.listDisplay.listDiv.style("width",(0==this.fullWidthResultSet()?t+9:this.divWidth-15)+"px");var e=t-10;this.fullWidthResultSet()&&(e+=this.width_leftPanel_total),this.listDisplay.updateContentWidth(e)}this.maxTotalColWidth=t*this.listMaxColWidthMult},getFilteringState:function(t,e){var i={results:this.itemsSelectedCt,textSrch:this.root.select("input.bigTextSearch").value};return null!==t&&(i.facet=t),i.filtered="",i.selected="",i.itemInfo=e,this.charts.forEach(function(t,e){"scatterplot"===t.type&&t.isFiltered_Time()&&(i.timeFltr=1),0!==t.attribCount_Selected&&(""!==i.filtered&&(i.filtered+="x",i.selected+="x"),i.filtered+=e,i.selected+=t.attribCount_Selected)}),""===i.filtered&&(i.filtered=null),""===i.selected&&(i.selected=null),i},hideListItemDetails:function(t){sendLog&&sendLog(CATID.ItemBased,ACTID_ITEM.Collapse,{itemID:t.id()}),t.listItem.setAttribute("details",!1),this.lastSelectedItem=void 0},showListItemDetails:function(t){sendLog&&sendLog(CATID.ItemBased,ACTID_ITEM.Show,{itemID:t.id()}),t.listItem.setAttribute("details",!0),"One"===this.listDisplay.detailsToggle&&this.lastSelectedItem&&this.lastSelectedItem.listItem.setAttribute("details",!1),this.lastSelectedItem=t}},kshf.BarChart=function(t,e){var i=this;this.id=++kshf.num_of_charts,this.parentKshf=t,this.options=e,this.selectType="SelectOr",this.collapsed=!1,e.collapsed===!0&&(this.collapsed=!0),this.scrollbar={firstRow:0},this.collapsedTime=!1,e.collapsedTime===!0&&(this.collapsedTime=!0),this.getKshfItems(),e.sortingOpts.forEach(function(t){void 0===t.no_resort&&(t.no_resort=!1),void 0===t.func&&(t.func=kshf.Util.sortFunc_ActiveCount_TotalCount),void 0===t.inverse&&(t.inverse=!1)}),this.sortingOpt_Active=e.sortingOpts[0],this.showConfig=this.options.sortingOpts.length>1,this.options.timeTitle?(this.type="scatterplot",this.filterCount=2,this.getKshf().maxFilterID++):(this.type="barChart",this.filterCount=1),this.attribFilter=new kshf.Filter({name:this.options.facetTitle,kshf_:this.getKshf(),onClear:this.clearFilter_Attrib_cb,text_header:this.options.textFilter?this.options.textFilter:this.options.facetTitle,text_item:this.text_item_Attrib,owner:this,filterTitle:this.options.facetTitle}),"scatterplot"===this.type&&(this.timeFilter=new kshf.Filter({name:this.options.timeTitle,kshf_:this.getKshf(),onClear:this.clearFilter_Time_cb,text_item:this.text_item_Time,owner:this,filterTitle:this.options.timeTitle})),this.init_shared(e),this.options.timeTitle?(this.options.display={row_bar_line:!0},this.getKshfItems().forEach(function(t){t.timePos=i.options.timeItemMap(t)}),this.timeData_dt={min:d3.min(this.getKshfItems(),this.options.timeItemMap),max:d3.max(this.getKshfItems(),this.options.timeItemMap)},this.updateAttrib_TimeMinMax(),this.getAttribs().forEach(function(t){t.xMin=t.xMin_Dyn,t.xMax=t.xMax_Dyn}),void 0===this.options.timeBarShow&&(this.options.timeBarShow=!1)):this.options.display={row_bar_line:!1}},kshf.BarChart.prototype={getKshf:function(){return this.parentKshf},getKshfItems:function(){return this.parentKshf.items},rowCount_Header_Left:function(){var t=1;return this.showConfig&&t++,this.showTextSearch&&t++,t},rowCount_Header_Right:function(){return"scatterplot"===this.type?this.collapsedTime?1:2:0},rowCount_Header:function(){return this.collapsed?1:Math.max(this.rowCount_Header_Left(),this.rowCount_Header_Right())},rowCount_Total:function(){if(this.collapsed)return 1;var t=0;return(this.scrollbar.show||this.parentKshf.hideBarAxis===!1)&&(t=1),this.rowCount_Header()+this.rowCount_Visible+t},rowCount_Total_Right:function(){return"scatterplot"!==this.type?0:this.collapsedTime===!0||this.collapsed===!0?1:this.rowCount_Header_Right()+this.rowCount_Visible+2},rowCount_MaxTotal:function(){return this.rowCount_Header()+this.attribCount_Active+1},rowCount_MinTotal:function(){return this.rowCount_Header()+Math.min(this.attribCount_Active,3)+1},allAttribsVisible:function(){return this.attribCount_Active===this.rowCount_Visible},init_shared:function(t){if(this.parentKshf.barMaxWidth=0,this.options.timeMaxWidth=0,void 0===this.options.showNoneCat&&(this.options.showNoneCat=!1),void 0===this.options.removeInactiveAttrib&&(this.options.removeInactiveAttrib=!0),"scatterplot"===this.type&&void 0===this.options.timeItemMap&&(this.options.timeItemMap=this.getKshf().columnAccessFunc(this.options.timeTitle)),void 0===this.options.catItemMap?this.options.catItemMap=this.getKshf().columnAccessFunc(this.options.facetTitle):"string"==typeof this.options.catItemMap&&(this.options.catItemMap=this.getKshf().columnAccessFunc(this.options.catItemMap)),this.options.generateRows?(this.catTableName=this.options.catTableName+"_h_"+this.id,this.getKshf().createTableFromTable(this.getKshfItems(),this.catTableName,this.options.catItemMap)):this.catTableName=this.options.catTableName,void 0===this.options.catLabelText&&(t.catLabelText=function(t){return t.data[1]}),this.options.showNoneCat===!0){var e=1e3,i=new kshf.Item([e,"None"],0);i.browser=this.getKshf(),kshf.dt[this.catTableName].push(i),kshf.dt_id[this.catTableName][e]=i;var s=this.options.catLabelText,a=this.options.catTooltipText,r=this.options.catItemMap;this.options.catLabelText=function(t){return t.id()===e?"None":s(t)},this.options.catTooltipText=function(t){return t.id()===e?"None":a(t)},this.options.catItemMap=function(t){var i=r(t);return null===i?e:i instanceof Array&&0===i.length?e:i}}this.hasMultiValueItem=!1;var o=this.getAttribs_wID();this.getKshfItems().forEach(function(t){var e=this.options.catItemMap(t);if(void 0===e||""===e)e=null;else if(e instanceof Array){var i={};e=e.filter(function(t){return void 0===i[t]?(i[t]=!0,!0):!1})}t.mappedData[this.attribFilter.id]=e;var s=[];if(null!==e){if(e instanceof Array)this.hasMultiValueItem=!0,e.forEach(function(e){var i=o[e];i&&(i.items.push(t),i.activeItems++,i.barValue+=t.barCount,i.barValueMax+=t.barCount,i.sortDirty=!0,s.push(i))});else{var a=o[e];a.items.push(t),a.activeItems++,a.barValue+=t.barCount,a.barValueMax+=t.barCount,a.sortDirty=!0,s.push(o[e])}t.mappedRows.push(s)}},this),this._dataMap=this.options.dataMap?function(e){return 0===e.items.length?null:t.dataMap(e)}:function(t){return 0===t.items.length?null:t.id()},this.updateAttribCount_Total(),this.updateAttribCount_Active(),this.unselectAllAttribs(),this.showTextSearch=this.attribCount_Total>=20&&this.options.forceSearch!==!1||this.options.forceSearch===!0,this.x_axis_active_filter=null},updateAttribCount_Total:function(){this.attribCount_Total=0,this.getAttribs().forEach(function(t){null!==this._dataMap(t)&&this.attribCount_Total++},this)},updateAttribCount_Active:function(){this.attribCount_Active=0,this.getAttribs().forEach(function(t){null!==this._dataMap(t)&&this.isAttribVisible(t)!==!1&&this.attribCount_Active++},this)},getWidth_Total:function(){var t=this.getKshf();return this.getWidth_Left()+("scatterplot"===this.type?this.options.timeMaxWidth+t.sepWidth+(this.scrollbar.show?t.scrollWidth+t.scrollPadding:0):0)},getWidth_Left:function(){var t=this.getKshf();return t.getRowTotalTextWidth()+t.barMaxWidth+t.scrollWidth+t.scrollPadding+1},refreshUIWidth:function(){this.refreshScrollbarPos();var t=this.getWidth_Left(),e=this.getWidth_Total()+5;this.divRoot.style("width",e+"px"),this.root.select("rect.chartBackground").attr("width",e),this.divRoot.select("rect.clippingRect_2").attr("x",t).attr("width",this.options.timeMaxWidth+10+7),this.divRoot.select(".headerGroup").style("width",e+"px"),this.root.select("rect.clippingRect").attr("width",e+5),this.dom_headerGroup.select(".leftHeader").style("width",t+"px")},scrollItemCb:function(t){var e=0;return t||(t=window.event),t.wheelDelta?e=t.wheelDelta/60:t.detail&&(e=-t.detail/2),-.05>e&&this.setScrollPosition(this.scrollbar.firstRow+1),e>.05&&this.setScrollPosition(this.scrollbar.firstRow-1),t.preventDefault?(t.preventDefault(),void 0):!1},init_DOM:function(){var t=this;this.divRoot=this.options.layout.append("div").attr("class","kshfChart").attr("removeInactiveAttrib",this.options.removeInactiveAttrib).attr("filtered_row",!1),this.dom_headerGroup=this.divRoot.append("div").attr("class","headerGroup"),this.root=this.divRoot.append("svg").attr("class","chart_root").attr("xmlns","http://www.w3.org/2000/svg"),this.root.append("rect").attr("class","chartBackground").on("mousewheel",this.scrollItemCb.bind(this)).on("mousedown",function(){d3.event.preventDefault()}),this.dom={},"scatterplot"===this.type&&void 0!==this.options.timeDotConfig&&this.divRoot.attr("dotconfig",this.options.timeDotConfig),this.root.append("g").attr("class","x_axis").on("mousedown",function(){d3.event.preventDefault()});var e=this.root.append("g").attr("class","barGroup_Top").attr("clip-path","url(#kshf_chart_clippath_"+this.id+")").attr("transform","translate(0,20)");"scatterplot"===this.type&&e.append("line").attr("class","selectVertLine").attr("x1",0).attr("x2",0).attr("y1",1.5*-this.getKshf().line_height);var i=e.append("g").attr("class","barGroup");if(i.selectAll("g.row").data(this.getAttribs(),this._dataMap).enter().append("g").attr("class","row").each(function(e){var i=this;e.barChart=t,e.items.forEach(function(t){t.mappedAttribs.push(i)})}),this.dom.g_row=this.root.selectAll("g.row"),"scatterplot"===this.type){var s=this.root.append("g").attr("class","timeAxisGroup").on("mousedown",function(){d3.event.preventDefault()});s.append("g").attr("class","tickGroup")}1===this.attribCount_Active&&(this.options.catBarScale="scale_frequency"),this.insertHeader(),this.insertScrollbar(),this.insertAttribs(),"scatterplot"===this.type&&(this.insertTimeChartRows(),this.insertTimeChartAxis_1())},getAttribs:function(){return kshf.dt[this.catTableName]},getAttribs_wID:function(){return kshf.dt_id[this.catTableName]},getMaxTotalItemsPerRow:function(){if(!this._maxTotalItemsPerRow){var t=this._dataMap;this._maxTotalItemsPerRow=d3.max(this.getAttribs(),function(e){return null===t(e)?null:e.items.length})}return this._maxTotalItemsPerRow},getMaxBarValuePerAttrib:function(){var t=this._dataMap;return d3.max(this.getAttribs(),function(e){return null===t(e)?null:e.barValue})},getMaxBarValueMaxPerAttrib:function(){var t=this._dataMap;return d3.max(this.getAttribs(),function(e){return null===t(e)?null:e.barValueMax})},refreshUI:function(){this.updateBarAxisScale(),this.refreshActiveItemCount(),this.refreshBarHeight(),"scatterplot"===this.type&&(this.refreshTimeChartTooltip(),this.refreshTimeChartBarDisplay(),this.refreshTimeChartDotConfig()),this.refreshWidth_Bars_Active(),this.options.removeInactiveAttrib&&this.updateAttribCount_Active(),this.updateSorting()},updateAttrib_TimeMinMax:function(){var t=function(t){return t.wanted?t.timePos:void 0};this.getAttribs().forEach(function(e){e.sortDirty!==!1&&(e.xMin_Dyn=d3.min(e.items,t),e.xMax_Dyn=d3.max(e.items,t))})},refreshActiveItemCount:function(){var t=this;this.dom.item_count.text(function(t){return"("+kshf.Util.formatForItemCount(t.barValue)+")"}),this.dom.g_row.each(function(e){this.setAttribute("noitems",!t.isAttribSelectable(e))}),this.dom.row_title.text(function(e){return(0===e.activeItems?"No":e.activeItems)+" selected "+t.getKshf().itemName+" "+(t.options.textFilter?t.options.textFilter:"- "+t.options.facetTitle+":")+" "+(t.options.catTooltipText?t.options.catTooltipText(e):t.options.catLabelText(e))})},refreshBarHeight:function(){this.dom.allRowBars.attr("height",function(t){return t.activeItems>0?12:6}).attr("y",function(t){return t.activeItems>0?3:6}),this.dom.timeBar&&this.dom.timeBar.attr("height",function(t){return t.activeItems>0?12:6}).attr("y",function(t){return t.activeItems>0?3:6}),this.dom.bar_active.attr("height",function(t){return t.activeItems>0?10:4}).attr("y",function(t){return t.activeItems>0?4:7})},refreshWidth_Bars_Active:function(){var t=this;this.dom.bar_active.transition().duration(this.getKshf().anim_barscale_duration).attr("width",function(e){return t.catBarAxisScale(e.barValue)})},refreshBarLineHelper:function(){this.dom.row_bar_line.attr("stroke",function(t){return 1===t.orderIndex%2?"rgb(200,200,200)":"rgb(80,80,80)"})},getFilteredCount:function(){var t=this.isFiltered_Attrib();return"scatterplot"===this.type&&(t+=this.isFiltered_Time()),t},isFiltered_Attrib:function(){return 0!==this.attribCount_Selected},isFiltered_Time:function(){return this.timeFilter_ms.min!==this.timeRange_ms.min||this.timeFilter_ms.max!==this.timeRange_ms.max},unselectAllAttribs:function(){this.getAttribs().forEach(function(t){t.selected=!1}),this.attribCount_Selected=0},clearFilters_All:function(){this.attribFilter.clearFilter(!1),void 0!==this.timeFilter&&this.timeFilter.clearFilter(!1)},clearFilter_Attrib_cb:function(){this.unselectAllAttribs(),this.refreshAttribFilter(),this.dom.showTextSearch&&(this.dom.showTextSearch[0][0].value="")},clearFilter_Time_cb:function(){this.resetTimeFilter_ms(),this.resetTimeZoom_ms(),this.refreshTimechartLayout(!0),this.yearSetXPos(),this.timeFilter.clearFilter(!0)},resetTimeFilter_ms:function(){this.timeFilter_ms={min:this.timeRange_ms.min,max:this.timeRange_ms.max}},resetTimeZoom_ms:function(){this.timeZoom_ms={min:this.timeRange_ms.min,max:this.timeRange_ms.max}},collapseAttribs:function(t){this.collapsed=t,sendLog&&(t===!0?sendLog(CATID.FacetCollapse,ACTID_COLLAPSE.Collapse,{facet:this.options.facetTitle}):sendLog(CATID.FacetCollapse,ACTID_COLLAPSE.Show,{facet:this.options.facetTitle})),this.getKshf().updateLayout_Height()},collapseTime:function(t){this.collapsedTime=t,this.getKshf().updateLayout_Height()},refreshTimeAxisPosition:function(){var t=this.getKshf(),e=this.parentKshf.barMaxWidth+t.scrollPadding+t.scrollWidth+t.sepWidth+this.parentKshf.getRowTotalTextWidth(),i=t.line_height*this.rowCount_Visible+27;this.root.select("g.timeAxisGroup").transition().duration(t.anim_layout_duration).attr("transform","translate("+e+","+i+")")},insertHeader:function(){var t=this;this.rowCount_Header_Left();var e;"scatterplot"===this.type&&(e=this.dom_headerGroup.append("div").attr("class","rightHeader"));var i=this.dom_headerGroup.append("div").attr("class","leftHeader");i.append("div").attr("class","border_line");var s=i.append("div").attr("class","chartFirstLineBackground");i.append("div").attr("class","border_line");var a=s.append("div").attr("class","leftHeader_XX");if(a.append("span").attr("class","header_label").attr("title",this.attribCount_Total+" attributes").html(this.options.facetTitle).on("click",function(){t.collapsed&&t.collapseAttribs(!1)}),a.append("span").attr("class","header_label_arrow").attr("title","Show/Hide attributes").text("▼").on("click",function(){t.collapseAttribs(!t.collapsed)}),a.append("div").attr("class","chartClearFilterButton rowFilter alone").text("x").attr("title","Remove filter").each(function(){this.tipsy=new Tipsy(this,{gravity:"n",fade:!0,opacity:1,title:function(){return"<span class='big'>x</span class='big'> <span class='action'>Remove</span> filter"}})}).on("mouseover",function(){this.tipsy.show()}).on("mouseout",function(){this.tipsy.hide(),d3.event.stopPropagation()}).on("click",function(){t.attribFilter.clearFilter(!0),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.ClearOnFacet,t.getKshf().getFilteringState(t.options.facetTitle))}),"scatterplot"===this.type){e.append("div").attr("class","border_line");var r=e.append("div").attr("class","chartFirstLineBackground chartFirstLineBackgroundRight");r.append("span").attr("class","header_label_arrow").attr("title","Show/Hide categories").text("▼").on("click",function(){t.collapseTime(!t.collapsedTime)}),r.append("span").attr("class","header_label").text(this.options.timeTitle).on("click",function(){t.collapsedTime&&t.collapseTime(!1)}),r.append("div").attr("class","chartClearFilterButton timeFilter alone").attr("title","Remove filter").on("click",function(){t.timeFilter.clearFilter(!0),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.ClearOnFacet,{facet:t.options.timeTitle,results:t.getKshf().itemsSelectedCt})}).text("x"),e.append("div").attr("class","border_line");var o=e.append("div").attr("class","config_zoom");o.append("span").attr("class","zoom_button zoom_in").attr("disabled","true").text("⇥ Zoom in ⇤").on("mouseover",function(){d3.select(this.parentNode).attr("zoom","in")}).on("mouseout",function(){d3.select(this.parentNode).attr("zoom","none")}).on("click",function(){t.timeZoom_ms.min=t.timeFilter_ms.min,t.timeZoom_ms.max=t.timeFilter_ms.max,t.useCurrentTimeMinMax=!0,t.refreshTimechartLayout(!0),t.useCurrentTimeMinMax=void 0,t.divRoot.select(".zoom_out").attr("disabled","false"),t.divRoot.select(".zoom_in").attr("disabled","true")
}),o.append("span").attr("class","zoom_button zoom_out").attr("disabled","true").text("⇤ Zoom out ⇥").on("mouseover",function(){d3.select(this.parentNode).attr("zoom","out")}).on("mouseout",function(){d3.select(this.parentNode).attr("zoom","none")}).on("click",function(){t.resetTimeZoom_ms(),t.useCurrentTimeMinMax=!0,t.refreshTimechartLayout(!0),t.useCurrentTimeMinMax=void 0,t.divRoot.select(".zoom_out").attr("disabled","true")})}var n=i.append("div").attr("class","header_belowFirstRow"),l=i.append("svg").attr("class","resort_button").attr("version","1.1").attr("height","15px").attr("width","15px").attr("title","Settings").attr("xml:space","preserve").attr("viewBox","0 0 2000 1000").style("left",this.parentKshf.categoryTextWidth+5+"px").on("click",function(){t.updateSorting(0),sendLog&&sendLog(CATID.FacetSort,ACTID_SORT.ResortButton,{facet:t.options.facetTitle})});if(l.append("path").attr("d","M736 96q0 -12 -10 -24l-319 -319q-10 -9 -23 -9q-12 0 -23 9l-320 320q-15 16 -7 35q8 20 30 20h192v1376q0 14 9 23t23 9h192q14 0 23 -9t9 -23v-1376h192q14 0 23 -9t9 -23zM1792 -32v-192q0 -14 -9 -23t-23 -9h-832q-14 0 -23 9t-9 23v192q0 14 9 23t23 9h832 q14 0 23 -9t9 -23zM1600 480v-192q0 -14 -9 -23t-23 -9h-640q-14 0 -23 9t-9 23v192q0 14 9 23t23 9h640q14 0 23 -9t9 -23zM1408 992v-192q0 -14 -9 -23t-23 -9h-448q-14 0 -23 9t-9 23v192q0 14 9 23t23 9h448q14 0 23 -9t9 -23zM1216 1504v-192q0 -14 -9 -23t-23 -9h-256 q-14 0 -23 9t-9 23v192q0 14 9 23t23 9h256q14 0 23 -9t9 -23z"),l.append("title").text("Move selected rows to top & re-order"),this.showTextSearch){var h=n.append("div").attr("class","leftHeader_XX").attr("class","chartRowLabelSearch").style("white-space","nowrap").style("position","relative");this.dom.showTextSearch=h.append("input").attr("type","text").attr("placeholder","Search: "+this.options.facetTitle.toLowerCase()).on("input",function(){this.timer&&clearTimeout(this.timer);var e=this;this.timer=setTimeout(function(){var i=e.value.toLowerCase();""===i?(h.select("svg.clearText").style("display","none"),t.attribFilter.clearFilter(!0)):(h.select("svg.clearText").style("display","block"),t.attribCount_Selected=0,t.getAttribs().forEach(function(e){e.selected=-1!==t.options.catLabelText(e).toString().toLowerCase().indexOf(i)?!0:t.options.catTooltipText?-1!==t.options.catTooltipText(e).toLowerCase().indexOf(i):!1,t.attribCount_Selected+=e.selected}),0===t.attribCount_Selected?t.attribFilter.clearFilter(!0):(t.selectType="SelectOr",t.updateSelected_All(),t.refreshAttribFilter(),t.attribFilter.addFilter(!0))),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.CatTextSearch,t.getKshf().getFilteringState(t.options.facetTitle))},750)}).on("blur",function(){d3.event.stopPropagation(),d3.event.preventDefault()}),h.append("svg").attr("class","searchIcon").attr("width","13").attr("height","12").attr("viewBox","0 0 491.237793 452.9882813").attr("xmlns","http://www.w3.org/2000/svg").append("use").attr("xlink:href","#kshf_svg_search"),h.append("svg").attr("class","clearText").attr("width","13").attr("height","13").attr("viewBox","0 0 48 48").attr("xmlns","http://www.w3.org/2000/svg").append("use").attr("xlink:href","#kshf_svg_clearText").on("click",function(){h.select("svg.clearText").style("display","none");var e=h.select("input")[0][0];e.value="",t.attribFilter.clearFilter(!0)})}var c=n.append("div").attr("class","configGroup leftHeader_XX").attr("shown","order").style("height",this.parentKshf.line_height+"px");if(this.showConfig){var d=c.append("span").attr("class","sortOptionSelectGroup");d.append("select").attr("class","optionSelect").on("change",function(){sendLog&&sendLog(CATID.FacetSort,ACTID_SORT.ChangeSortFunc,{facet:t.options.facetTitle,funcID:this.selectedIndex}),t.sortingOpt_Active=t.options.sortingOpts[this.selectedIndex],t.updateSorting.call(t,0)}).selectAll("input.sort_label").data(this.options.sortingOpts).enter().append("option").attr("class","sort_label").text(function(t){return t.name}).attr(function(t){return t.name}),d.append("span").attr("class","optionSelect_Label").text("Order by")}},refreshTimechartLayout:function(t){this.setTimeTicks(),this.updateTimeChartBarsDots(),this.refreshTimeChartBarDisplay(),this.insertTimeTicks(),this.insertTimeChartAxis(),t===!0&&this.refreshTimeChartDotConfig()},setTimeWidth:function(t){this.options.timeMaxWidth=t,this.scrollbar.show===!0&&(this.options.timeMaxWidth-=this.getKshf().scrollPadding+this.getKshf().scrollWidth),this.refreshTimechartLayout(!0),this.refreshUIWidth(),this.dom_headerGroup.select(".rightHeader").style("width",t+"px"),this.refreshTimeAxisPosition(),this.updateRowBarLineWidth()},refreshTimeChartDotConfig:function(){if("scatterplot"===this.type&&void 0===this.options.timeDotConfig&&this.skipUpdateTimeChartDotConfig!==!0){var t=this,e=0;this.dom.g_row.each(function(i){(0===t.attribCount_Selected||i.selected)&&void 0!==i.xMax_Dyn&&void 0!==i.xMin_Dyn&&(e+=t.timeScale(i.xMax_Dyn)-t.timeScale(i.xMin_Dyn))}),this.timeFilter_ms.max-this.timeFilter_ms.min,this.timeZoom_ms.max-this.timeZoom_ms.min;var i=12,s=e/i,a=this.parentKshf.itemsSelectedCt;s>3*a||0===e?(this.dom.timeDots.style("stroke","#EEE"),this.dom.timeDots.style("fill","#616F7A")):(this.dom.timeDots.style("stroke","none"),s>1.5*a?this.dom.timeDots.style("fill","url(#dotGradient100)"):s>.8*a?this.dom.timeDots.style("fill","url(#dotGradient75)"):s>.3*a?this.dom.timeDots.style("fill","url(#dotGradient50)"):this.dom.timeDots.style("fill","url(#dotGradient25)"))}},updateBarAxisScale:function(){this.catBarAxisScale="scale_frequency"===this.options.catBarScale?d3.scale.linear().domain([0,this.parentKshf.itemsSelectedCt]).rangeRound([0,this.parentKshf.barMaxWidth]):d3.scale.linear().domain([0,this.getMaxBarValuePerAttrib()]).rangeRound([0,this.parentKshf.barMaxWidth]),this.refreshWidth_Bars_Total(),this.insertXAxisTicks()},updateBarWidth:function(){this.updateBarAxisScale(),this.refreshWidth_Bars_Active(),this.updateRowBarLineWidth(),this.refreshUIWidth()},updateRowBarLineWidth:function(){var t=this.getKshf(),e=t.barMaxWidth+t.scrollPadding+t.scrollWidth+t.sepWidth+t.getRowTotalTextWidth()+this.options.timeMaxWidth;this.dom.row_bar_line.attr("x2",e)},refreshScrollbar:function(t){var e=this,i=this.getKshf(),s=i.line_height*this.scrollbar.firstRow,a=s*(this.rowCount_Visible/this.attribCount_Active.toFixed());if(t){var r=i.line_height*this.rowCount_Visible*this.rowCount_Visible/this.attribCount_Active.toFixed();10>r&&(r=10),this.root.selectAll("g.scrollGroup rect.background_up").transition().duration(i.anim_layout_duration).attr("height",a),this.root.selectAll("g.scrollGroup rect.background_down").transition().duration(i.anim_layout_duration).attr("y",a).attr("height",i.line_height*this.rowCount_Visible-a),this.root.selectAll("g.scrollGroup rect.handle").transition().duration(i.anim_layout_duration).attr("height",r).attr("y",a),this.root.select("g.barGroup").transition().duration(i.anim_layout_duration).ease(d3.ease("cubic-out")).attr("transform",function(){return"translate(0,-"+s+")"})}else this.root.selectAll("g.scrollGroup rect.background_up").attr("height",a+5),this.root.selectAll("g.scrollGroup rect.background_down").attr("y",a).attr("height",i.line_height*this.rowCount_Visible-a),this.root.selectAll("g.scrollGroup rect.handle").attr("y",a),this.root.select("g.barGroup").attr("transform",function(){return"translate(0,-"+s+")"});this.root.selectAll("g.scrollGroup g.top_arrow").style("display",0!==this.scrollbar.firstRow?"inline":"none"),this.root.select("text.scroll_display_more").style("display",this.scrollbar.firstRow!==this.getMaxVisibleFirstRow()?"inline":"none").text(function(){return e.scrollbar.firstRow===e.getMaxVisibleFirstRow()?"":e.attribCount_Active-e.rowCount_Visible-e.scrollbar.firstRow+" more..."}),this.root.selectAll("g.scrollGroup text.first_row_number").text(0===this.scrollbar.firstRow?"":this.scrollbar.firstRow).attr("y",a-1)},getMaxVisibleFirstRow:function(){return this.attribCount_Active-this.rowCount_Visible},setRowCount_VisibleAttribs:function(t){0>t&&(t=1),t>this.attribCount_Active&&(t=this.attribCount_Active),t=this.attribCount_Active<=2?this.attribCount_Active:Math.max(t,2),this.rowCount_Visible=t},refreshVisibleAttribs:function(){var t=this.getKshf(),e=t.line_height*this.rowCount_Total(),i=t.line_height*this.rowCount_Visible,s=t.line_height*this.rowCount_Header();this.scrollbar.show=this.rowCount_Visible!==this.attribCount_Active,this.divRoot.attr("collapsed",this.collapsed===!1?"false":"true").attr("showconfig",this.showConfig).attr("collapsedTime",this.collapsedTime===!1?"false":"true").attr("showscrollbar",this.scrollbar.show).attr("selectType",this.selectType).attr("hasMultiValueItem",this.hasMultiValueItem),"scatterplot"!==this.type&&this.divRoot.transition().duration(t.anim_layout_duration).style("height",e+"px"),this.root.transition().duration(t.anim_layout_duration).style("height",e+"px"),this.scrollbar.firstRow=Math.min(this.scrollbar.firstRow,this.getMaxVisibleFirstRow()),this.scrollbar.rowScrollHeight=i/this.attribCount_Active,this.rowCount_Visible!==this.attribCount_Active&&(this.root.selectAll("g.scrollGroup rect.background").transition().duration(t.anim_layout_duration).attr("height",i+1),this.root.select("g.scrollGroup text.scroll_display_more").transition().duration(t.anim_layout_duration).attr("y",i+10),this.refreshScrollbarPos(),this.refreshScrollbar(!0)),this.root.select(".x_axis").transition().duration(t.anim_layout_duration).attr("transform","translate("+t.getRowTotalTextWidth()+",23)"),this.root.select("rect.chartBackground").attr("height",i).attr("y",s),this.root.selectAll(".barChartClipPath rect").transition().duration(t.anim_layout_duration).attr("height",i),"scatterplot"===this.type&&this.refreshTimeAxisPosition(),this.root.selectAll("g.timeAxisGroup g.filter_handle line").transition().duration(t.anim_layout_duration).attr("y1",-i-8).attr("y2",-8),this.root.selectAll("g.timeAxisGroup rect.filter_nonselected").attr("y",-i-8).attr("height",i),this.root.selectAll("line.selectVertLine").attr("y2",t.line_height*(this.rowCount_Visible+1.5)),this.root.selectAll("g.x_axis g.tick line").transition().duration(t.anim_layout_duration).attr("y2",i),this.root.selectAll("g.x_axis g.tick text").transition().duration(t.anim_layout_duration).attr("dy",i+3)},setScrollPosition:function(t){0>t&&(t=0),t>this.getMaxVisibleFirstRow()&&(t=this.getMaxVisibleFirstRow()),this.scrollbar.firstRow!==t&&(this.scrollbar.firstRow=t,this.refreshScrollbar())},stepScrollPosition:function(t){0===this.scrollbar.firstRow&&0>t||this.scrollbar.firstRow===this.getMaxVisibleFirstRow()&&t>0||this.scrollBarUp_Active&&(this.scrollbar.firstRow+=t,this.refreshScrollbar(),this.scrollBarUp_TimeStep-=10,this.scrollBarUp_TimeStep<15&&(this.scrollBarUp_TimeStep=15),window.setTimeout(this.stepScrollPosition.bind(this,t),this.scrollBarUp_TimeStep))},insertScrollbar:function(){var t=this,e=this.root.append("g").attr("class","scrollGroup").attr("transform","translate(0,20)").on("mousedown",function(){d3.event.preventDefault()});this.dom.leftScroll=e.append("g").attr("class","leftScroll"),this.insertScrollbar_do(this.dom.leftScroll),"scatterplot"===this.type&&(this.dom.rightScroll=e.append("g").attr("class","rightScroll"),this.insertScrollbar_do(this.dom.rightScroll)),e.append("text").attr("class","scroll_display_more").on("mousedown",function(){e.selectAll("text.row_number").style("display","block"),t.scrollBarUp_Active=!0,t.scrollBarUp_TimeStep=200,t.stepScrollPosition(1),sendLog&&sendLog(CATID.FacetScroll,ACTID_SCROLL.ClickMore,{facet:t.options.facetTitle,firstRow:t.scrollbar.firstRow})}).on("mouseup",function(){t.scrollBarUp_Active=!1}).on("mouseover",function(){d3.select(this).attr("highlight",!0)}).on("mouseout",function(){d3.select(this).attr("highlight",!1),t.scrollBarUp_Active=!1,e.selectAll("text.row_number").style("display","none")})},insertScrollbar_do:function(t){var e=this,i=this.getKshf(),s=function(){e.scrollBarUp_Active=!1},a=t.append("g").attr("class","top_arrow").attr("transform","translate(1,-13)");a.append("title").text("Top"),a.append("rect").attr("width",i.scrollWidth).attr("height",11).on("click",function(){e.scrollbar.firstRow=0,e.refreshScrollbar(!0),sendLog&&sendLog(CATID.FacetScroll,ACTID_SCROLL.ScrollToTop,{facet:e.options.facetTitle,firstRow:e.scrollbar.firstRow})}),a.append("path").attr("class","top_arrow").attr("d","M4 0 L0 3 L0 6 L4 3 L8  6 L8  3 Z M4 5 L0 8 L0 11 L4 8 L8 11 L8  8 Z"),t.append("rect").attr("class","background").attr("width",i.scrollWidth+1).attr("rx",4).attr("ry",4).attr("x",-.5).attr("y",-.5),t.append("rect").attr("class","background_fill background_up").attr("width",i.scrollWidth).attr("rx",4).attr("ry",4).on("mousedown",function(){e.scrollBarUp_Active=!0,e.scrollBarUp_TimeStep=200,e.stepScrollPosition(-1),sendLog&&sendLog(CATID.FacetScroll,ACTID_SCROLL.ClickScrollbar,{facet:e.options.facetTitle,firstRow:e.scrollbar.firstRow})}).on("mouseup",function(){e.scrollBarUp_Active=!1}).on("mouseout",s),t.append("rect").attr("class","background_fill background_down").attr("width",i.scrollWidth).attr("rx",4).attr("ry",4).on("mousedown",function(){e.scrollBarUp_Active=!0,e.scrollBarUp_TimeStep=200,e.stepScrollPosition(1),sendLog&&sendLog(CATID.FacetScroll,ACTID_SCROLL.ClickScrollbar,{facet:e.options.facetTitle,firstRow:e.scrollbar.firstRow})}).on("mouseup",function(){e.scrollBarUp_Active=!1}).on("mouseout",s),t.append("rect").attr("class","handle").attr("x",0).attr("y",0).attr("rx",4).attr("ry",4).attr("width",i.scrollWidth).on("mouseout",s).on("mousedown",function(){e.scrollbar.active=!0,d3.select(this).attr("selected",!0),e.root.style("cursor","pointer");var i=d3.mouse(this.parentNode.parentNode.parentNode)[1],s=e.scrollbar.firstRow;t.selectAll("text.row_number").style("display","block"),e.root.on("mousemove",function(){var t=d3.mouse(this)[1],a=t-i,r=Math.round(a/e.scrollbar.rowScrollHeight);if(0!==r){var o=s+r;0>o&&(o=0),o>e.getMaxVisibleFirstRow()&&(o=e.getMaxVisibleFirstRow()),e.scrollbar.firstRow=o,e.refreshScrollbar()}}).on("mouseup",function(){e.root.style("cursor","default"),e.scrollbar.active=!1;var i=e.root.select("g.scrollGroup rect.handle");i.attr("selected",!1),t.selectAll("text.row_number").style("display",""),e.root.on("mousemove",null).on("mouseup",null),sendLog&&sendLog(CATID.FacetScroll,ACTID_SCROLL.DragScrollbar,{facet:e.options.facetTitle,firstRow:e.scrollbar.firstRow})})}),t.append("text").attr("class","first_row_number row_number").attr("x",i.scrollWidth),t.append("text").attr("class","last_row_number row_number").attr("x",i.scrollWidth)},refreshScrollbarPos:function(){var t=this.getKshf();this.dom.leftScroll.transition().duration(t.anim_layout_duration).attr("transform","translate("+(t.getRowTotalTextWidth()+t.barMaxWidth+t.scrollPadding)+",0)"),"scatterplot"===this.type&&this.dom.rightScroll.transition().duration(t.anim_layout_duration).attr("transform","translate("+(this.getWidth_Total()-t.scrollWidth-3)+",0)"),this.root.select("text.scroll_display_more").attr("x",t.categoryTextWidth)},filter_multi_and:function(t,e){var i=0;return t.forEach(function(t){e[t].selected&&i++}),i===this.attribCount_Selected},updateItemFilterState_Attrib:function(){if(0!==this.attribCount_Selected){var t=this.getAttribs_wID(),e=this.attribFilter.id,i=!1;if("SelectAnd"===this.selectType){var s=this.filter_multi_and;this.getKshfItems().forEach(function(a){var r=a.mappedData[e];void 0!==r&&null!==r&&""!==r&&(i=r instanceof Array?s.call(this,r,t):this.attribCount_Selected>1?!1:t[r].selected),a.setFilter(e,i)},this)}else{var s=kshf.Util.filter_multi_or;this.getKshfItems().forEach(function(a){var r=a.mappedData[e];void 0!==r&&null!==r&&""!==r&&(i=r instanceof Array?s.call(this,r,t):t[r].selected),a.setFilter(e,i)},this)}}},updateItemFilterState_Time:function(){var t=this.timeFilter.id;this.getKshfItems().forEach(function(e){e.setFilter(t,e.timePos>=this.timeFilter_ms.min&&e.timePos<=this.timeFilter_ms.max),e.updateSelected()},this)},updateSelected_All:function(){this.updateItemFilterState_Attrib(),this.getKshfItems().forEach(function(t){t.updateSelected()})},updateSelected_UnSelectOnly:function(){this.updateItemFilterState_Attrib(),this.getKshfItems().forEach(function(t){t.updateSelected_UnSelectOnly()})},updateSelected_SelectOnly:function(){this.updateItemFilterState_Attrib(),this.getKshfItems().forEach(function(t){t.updateSelected_SelectOnly()})},isAttribVisible:function(t){return t.selected?!0:0!==t.activeItems?!0:this.isFiltered_Attrib()?"SelectAnd"===this.selectType?!1:!0:0!==t.activeItems},isAttribSelectable:function(t){return t.selected?!0:0!==t.activeItems?!0:this.isFiltered_Attrib()&&!this.hasMultiValueItem?!0:!1},filterAttrib:function(t,e){t.selected=!t.selected,this.attribCount_Selected+=t.selected?1:-1,t.selected?1===this.attribCount_Selected?(this.selectType="SelectOr",this.updateSelected_UnSelectOnly()):this.hasMultiValueItem?(2===this.attribCount_Selected&&(this.selectType=void 0===e?"SelectAnd":"SelectOr"),"SelectAnd"===this.selectType?this.updateSelected_UnSelectOnly():this.updateSelected_SelectOnly()):e===!0?this.updateSelected_SelectOnly():(this.unselectAllAttribs(),t.selected=!0,this.attribCount_Selected=1,this.updateSelected_All()):0===this.attribCount_Selected?(this.selectType="SelectOr",this.attribFilter.clearFilter(!0)):this.hasMultiValueItem?("SelectAnd"===this.selectType?this.updateSelected_SelectOnly():this.updateSelected_UnSelectOnly(),1===this.attribCount_Selected&&(this.selectType="SelectOr")):this.updateSelected_UnSelectOnly(),0!==this.attribCount_Selected&&this.attribFilter.addFilter(!0),this.refreshAttribFilter(),this.sortingOpt_Active.no_resort!==!0&&this.divRoot.attr("canResort",this.attribCount_Selected!==this.attribCount_Active&&0!==this.attribCount_Selected),this.dom.showTextSearch&&(this.dom.showTextSearch[0][0].value="")},refreshAttribFilter:function(){this.divRoot.attr("filtered_row",this.isFiltered_Attrib()),this.dom.g_row.attr("selected",function(t){return t.selected})},text_item_Attrib:function(){var t=this,e="",i=0,s=this.options.catLabelText,a=this.options.catTooltipText;return this.root.selectAll("g.row").each(function(r){if(r.selected){0!==i&&(e+="SelectAnd"===t.selectType?" and ":" or ");var o=s(r),n=o;a&&(n=a(r)),e+="<b>"+o+"</b>",i++}}),e},insertAttribs:function(){var t=this,e=this.getKshf(),i=this.root.select("g.barGroup_Top").on("mousedown",function(){d3.event.preventDefault()}).on("mousewheel",this.scrollItemCb.bind(this)).insert("g",":first-child").attr("class","barChartClipPath");i.insert("clipPath").attr("id","kshf_chart_clippath_"+this.id).append("rect").attr("class","clippingRect").attr("x",0).attr("y",0),i.insert("clipPath").attr("id","kshf_chart_clippathsm_"+this.id).append("rect").attr("class","clippingRect_2").attr("y",0),this.dom.g_row.attr("highlight","false").attr("selected","false").on("click",function(i){if(t.filterAttrib(i),this.tipsy_active.hide(),this.timer)return clearTimeout(this.timer),this.timer=null,t.unselectAllAttribs(),t.filterAttrib(i),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.CatValueExact,e.getFilteringState(t.options.facetTitle,i.data[1])),void 0;sendLog&&sendLog&&sendLog(CATID.FacetFilter,i.selected?ACTID_FILTER.CatValueAdd:ACTID_FILTER.CatValueRemove,e.getFilteringState(t.options.facetTitle,i.data[1]));var s=this;this.timer=setTimeout(function(){s.timer=null},500)}).each(function(){this.tipsy=new Tipsy(this,{gravity:"w",offset_y:9,offset_x:2,offset_x:t.parentKshf.getRowTotalTextWidth(),fade:!0,title:function(){var e=this.__data__,i=t.options.facetTitle,s=e.barChart.hasMultiValueItem;return e.selected?"<span class='big'>-</span class='big'> <span class='action'>Remove</span> <i>"+i+"</i> Filter":0===e.barChart.attribCount_Selected?"<span class='big'>+</span> <span class='action'>Add</span> <i>"+i+"</i> Filter":s===!1?"<span class='big'>&laquo;</span> <span class='action'>Change</span> <i>"+i+"</i> Filter":"<span class='big'>+</span> <span class='action'>Add</span> <i>"+i+"</i> (<b> ... and </b>)"}})}).on("mouseover",function(e){t.isAttribSelectable(e)&&(this.setAttribute("highlight",!0),e.items.forEach(function(t){t.wanted&&t.highlightListItem()}),this.tipsy_active=this.tipsy,e.selected===!1&t.attribCount_Selected>1&&"SelectOr"===t.selectType&&t.hasMultiValueItem&&(this.tipsy_active=d3.select(this).select(".filter_add_more")[0][0].tipsy),this.tipsy_active.show())}).on("mouseout",function(e){t.isAttribSelectable(e)&&(this.setAttribute("highlight",!1),e.items.forEach(function(t){t.wanted&&t.nohighlightListItem()}),this.tipsy_active.hide())}),this.dom.row_title=this.dom.g_row.append("title").attr("class","row_title"),this.dom.add_more=this.dom.g_row.append("g").attr("class","filter_add_more").each(function(){this.tipsy=new Tipsy(this,{gravity:"sw",offset_y:5,offset_x:1,fade:!0,title:function(){var e=this.__data__;return e.selected?"<span class='big'>+</span> <span class='action'>Remove</span> <i>"+t.options.facetTitle+"</i> Filter":"<span class='big'>+</span> <span class='action'>Add</span> <i>"+t.options.facetTitle+"</i> (<b> ... or </b>)"}})}).on("mouseover",function(t){t.selected||(this.tipsy.show(),this.parentNode.setAttribute("highlight",!0),d3.event.stopPropagation())}).on("mouseout",function(t){t.selected||(this.tipsy.hide(),this.parentNode.setAttribute("highlight",!1),d3.event.stopPropagation())}).on("click",function(e){e.selected||(t.filterAttrib(e,!0),this.tipsy.hide(),d3.event.stopPropagation())}),this.dom.add_more.append("text").attr("class","filter_add_more add").attr("dy",14).attr("dx",8).text("⊕"),this.dom.rowSelectBackground_Label=this.dom.g_row.append("rect").attr("class","rowSelectBackground rowSelectBackground_Label").attr("x",0).attr("y",0).attr("fill","url(#gr_rowSelectBackground_Label)").attr("height",e.line_height),this.dom.rowSelectBackground_Count=this.dom.g_row.append("rect").attr("class","rowSelectBackground rowSelectBackground_Count").attr("y",0).attr("fill","url(#gr_rowSelectBackground_Count)").attr("width",e.getRowLabelOffset()).attr("height",e.line_height),this.dom.rowSelectBackground_ClickArea=this.dom.g_row.append("rect").attr("class","rowSelectBackground_ClickArea").attr("x",20).attr("y",4).attr("height",e.line_height-8),this.dom.item_count=this.dom.g_row.append("text").attr("class","item_count").attr("dy",13),this.dom.cat_labels=this.dom.g_row.append("text").attr("class","row_label").attr("dy",14).text(this.options.catLabelText),this.dom.row_bar_line=this.options.display.row_bar_line?this.dom.g_row.append("line").attr("class","row_bar_line").attr("stroke-width","1").attr("y1",e.line_height/2).attr("y2",e.line_height/2):this.root.select(".row_bar_line"),this.dom.bar_active=this.dom.g_row.append("rect").attr("rx",2).attr("ry",2).attr("class",function(e,i){return"rowBar "+(t.options.barClassFunc?t.options.barClassFunc(e,i):"")+" active"}),this.dom.bar_total=this.dom.g_row.append("rect").attr("rx",2).attr("ry",2).attr("class",function(e,i){return"rowBar "+(t.options.barClassFunc?t.options.barClassFunc(e,i):"")+" total"}),this.dom.allRowBars=this.root.selectAll("g.barGroup g.row rect.rowBar").attr("x",e.getRowTotalTextWidth()),this.refreshTextWidth()},refreshTextWidth:function(){var t=this.getKshf();t.anim_barscale_duration=t.anim_barscale_duration_default;var e=t.anim_barscale_duration;this.dom.cat_labels.attr("x",this.options.rowTextWidth),this.dom.rowSelectBackground_Count.attr("x",this.options.rowTextWidth),this.dom.item_count.attr("x",this.options.rowTextWidth+3),this.dom.rowSelectBackground_Label.attr("width",this.options.rowTextWidth),this.dom.rowSelectBackground_ClickArea.attr("width",t.getRowTotalTextWidth()-20),this.dom.allRowBars.attr("x",t.getRowTotalTextWidth()),this.dom_headerGroup.selectAll(".leftHeader_XX").style("width",this.options.rowTextWidth+"px"),this.root.select("g.x_axis").transition().duration(e).attr("transform","translate("+t.getRowTotalTextWidth()+","+(t.line_height*this.rowCount_Header()+3)+")"),this.dom.showTextSearch&&this.dom.showTextSearch.style("width",this.options.rowTextWidth-20+"px"),this.dom.row_bar_line.attr("x1",t.getRowTotalTextWidth()+2)},refreshWidth_Bars_Total:function(){var t=this;this.dom.bar_total.transition().duration(this.getKshf().anim_barscale_duration).attr("width",function(e){return Math.min(t.catBarAxisScale(e.barValueMax),t.parentKshf.barMaxWidth+7)})},sortAttribs:function(){var t=this.sortingOpt_Active.no_resort!==!0,e=this.sortingOpt_Active.inverse,i=this.sortingOpt_Active.func,s=function(t,e){return e-t};"string"==typeof this.getAttribs()[0].id()&&(s=function(t,e){return e.localeCompare(t)});var a=function(a,r){if(t){if(!a.selected&&r.selected)return 1;if(a.selected&&!r.selected)return-1}if(0===a.activeItems&&0!==r.activeItems)return 1;if(0===r.activeItems&&0!==a.activeItems)return-1;var o=i(a,r);return 0===o&&(o=s(a.id(),r.id())),e&&(o=-o),o};this.getAttribs().sort(a),this.getAttribs().forEach(function(t,e){t.orderIndex=e})},updateSorting:function(t){var e=this.getKshf(),i=this;void 0===t&&(t=450),this.sortAttribs(),setTimeout(function(){0!==i.scrollbar.firstRow&&(i.scrollbar.firstRow=0,i.refreshScrollbar()),i.dom.g_row.data(i.getAttribs(),i._dataMap).order().transition().duration(300).attr("transform",function(t,i){return"translate(0,"+e.line_height*i+")"}),"scatterplot"===i.type&&i.refreshBarLineHelper(),i.divRoot.attr("canResort",!1)},t)},insertXAxisTicks:function(){var t=this.root.select("g.x_axis"),e=this.parentKshf.barMaxWidth/25;this.getMaxBarValuePerAttrib()>1e5&&(e=this.parentKshf.barMaxWidth/30);var i=d3.svg.axis().tickSize(0,0,0).orient("bottom").ticks(e).tickFormat(d3.format("s")).scale(this.catBarAxisScale);t.call(i),this.root.selectAll("g.x_axis g.tick text").attr("dy",3+this.rowCount_Visible*this.parentKshf.line_height),t.selectAll("g.tick line").attr("y1","0").attr("y2",this.getKshf().line_height*this.rowCount_Visible)},removeXAxis:function(){this.root.select("g.x_axis").data([]).exit().remove()},refreshTimeChartBarDisplay:function(){var t=this,e=this.getKshf(),i=this.getAttribs(),s=function(t,e){if(t.selected&&!e.selected)return 1;if(e.selected&&!t.selected)return-1;var i=t.timePos,s=e.timePos;return null===i||null===s?0:i.getTime()-s.getTime()};i.forEach(function(t){t.sortDirty&&"scatterplot"===this.type&&(t.items.sort(s),this.root.selectAll("g.row").selectAll(".timeDot").data(function(t){return t.items},function(t){return t.id()}).order())},this),this.updateAttrib_TimeMinMax(),this.dom.timeBarActive&&this.dom.timeBarActive.transition().duration(e.anim_barscale_duration).attr("x",function(i){return t.parentKshf.barMaxWidth+e.scrollWidth+e.sepWidth+e.scrollPadding+t.parentKshf.getRowTotalTextWidth()+t.timeScale(void 0===i.xMin_Dyn?i.xMin:i.xMin_Dyn)}).attr("width",function(e){return void 0===e.xMin_Dyn?0:t.timeScale(e.xMax_Dyn)-t.timeScale(e.xMin_Dyn)}),i.forEach(function(t){t.sortDirty=!1})},insertTimeChartRows:function(){var t=this,e=this.getKshf(),i=this.dom.g_row.append("g").attr("class","timeLineParts").attr("clip-path","url(#kshf_chart_clippathsm_"+this.id+")");this.options.timeBarShow===!0&&(i.append("rect").attr("class","timeBar total").attr("rx",2).attr("ry",2),i.append("rect").attr("class","timeBar active").attr("rx",2).attr("ry",2)),i.selectAll("g.timeDot").data(function(t){return t.items},function(t){return t.id()}).enter().append("circle").attr("class",function(e){return t.options.dotClassFunc?"timeDot "+t.options.dotClassFunc(e):"timeDot"}).attr("highlight","false").attr("r",5).attr("cy",Math.floor(e.line_height/2)).each(function(t){t.mappedDots.push(this)}).on("mouseover",function(i){i.highlightAll();var s=t.timeScale(t.options.timeItemMap(i)),a=t.parentKshf.barMaxWidth+e.scrollPadding+e.scrollWidth+e.sepWidth+t.parentKshf.getRowTotalTextWidth();t.root.select("line.selectVertLine").attr("x1",s+a).attr("x2",s+a).style("display","block"),d3.event.stopPropagation()}).on("mouseout",function(e){e.nohighlightAll(),t.root.select("line.selectVertLine").style("display","none"),d3.event.stopPropagation()}).on("click",function(i){var s=i.timePos,a=new Date(s),r=new Date(s);if(t.timeticks.range===d3.time.months&&(a.setDate(a.getDate()-15),r=new Date(a),r.setMonth(a.getMonth()+1)),t.timeticks.range===d3.time.years){var o=new Date(t.timeZoom_ms.max).getFullYear()-new Date(t.timeZoom_ms.min).getFullYear();t.options.timeMaxWidth<10*o?(a.setFullYear(a.getFullYear()-5),r.setFullYear(r.getFullYear()+5)):(a.setMonth(a.getMonth()-6),r=new Date(a),r.setMonth(a.getMonth()+12))}t.timeticks.range===d3.time.days&&(a.setDate(a.getDate()-1),r.setDate(a.getDate()+1)),t.timeFilter_ms.min=Date.parse(a),t.timeFilter_ms.max=Date.parse(r),t.yearSetXPos(),t.updateItemFilterState_Time(),t.timeFilter.addFilter(!1),t.unselectAllAttribs(),t.filterAttrib(d3.select(this.parentNode.parentNode).datum()),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.TimeDot,e.getFilteringState()),d3.event.stopPropagation()}),this.dom.timeBar=this.root.selectAll("g.barGroup g.row rect.timeBar"),this.dom.timeBarActive=this.root.selectAll("g.barGroup g.row rect.timeBar.active"),this.dom.timeBarTotal=this.root.selectAll("g.barGroup g.row rect.timeBar.total"),this.dom.timeDots=this.root.selectAll("g.barGroup g.row .timeDot")},setTimeTicks:function(){this.timeticks={};var t,e=864e5,i=30.4*e,s=365*e;t=void 0!==this.timeZoom_ms?this.timeZoom_ms.max-this.timeZoom_ms.min:this.timeData_dt.max.getTime()-this.timeData_dt.min.getTime();var a=Math.floor(t/e),r=Math.floor(t/i),o=Math.floor(t/s),n=this.options.timeMaxWidth/70;o>=n?(this.timeticks.range=d3.time.years,this.timeticks.format=d3.time.format.utc("%Y"),this.timeticks.stepSize=Math.ceil(o/(this.options.timeMaxWidth/30))):r>=n?(this.timeticks.range=d3.time.months,this.timeticks.format=d3.time.format.utc("%b '%y"),this.timeticks.stepSize=Math.ceil(r/(this.options.timeMaxWidth/60)),this.timeticks.stepSize>12?this.timeticks.stepSize=12:this.timeticks.stepSize>6?this.timeticks.stepSize=6:this.timeticks.stepSize>4&&(this.timeticks.stepSize=4)):(this.timeticks.range=d3.time.days,this.timeticks.format=d3.time.format.utc("%e %b"),this.timeticks.stepSize=Math.ceil(a/n/2),this.timeticks.stepSize>16?this.timeticks.stepSize=32:this.timeticks.stepSize>10?this.timeticks.stepSize=15:this.timeticks.stepSize>5&&(this.timeticks.stepSize=10),this.timeticks.stepSize++),void 0===this.useCurrentTimeMinMax&&(this.timeticks.range===d3.time.years?this.timeRange_ms={min:Date.UTC(this.timeData_dt.min.getUTCFullYear(),0,1),max:Date.UTC(this.timeData_dt.max.getUTCFullYear()+1,0,1)}:this.timeticks.range===d3.time.months?this.timeRange_ms={min:Date.UTC(this.timeData_dt.min.getUTCFullYear(),this.timeData_dt.min.getUTCMonth(),1),max:Date.UTC(this.timeData_dt.max.getUTCFullYear(),this.timeData_dt.max.getUTCMonth()+1,1)}:this.timeticks.range===d3.time.days&&(this.timeRange_ms={min:Date.UTC(this.timeData_dt.min.getUTCFullYear(),this.timeData_dt.min.getUTCMonth(),this.timeData_dt.min.getUTCDate()-1),max:Date.UTC(this.timeData_dt.max.getUTCFullYear(),this.timeData_dt.max.getUTCMonth(),this.timeData_dt.max.getUTCDate()+1)}),this.resetTimeZoom_ms(),this.resetTimeFilter_ms()),this.updateTimeScale()},updateTimeScale:function(){this.timeScale=d3.time.scale.utc().domain([new Date(this.timeZoom_ms.min),new Date(this.timeZoom_ms.max)]).rangeRound([0,this.options.timeMaxWidth])},insertTimeTicks:function(){var t=this,e=this.root.select("g.timeAxisGroup g.tickGroup");Math.floor(this.options.timeMaxWidth/70);var i=d3.svg.axis().scale(this.timeScale).orient("bottom").innerTickSize(8).outerTickSize(3).ticks(this.timeticks.range,this.timeticks.stepSize).tickFormat(this.timeticks.format);e.call(i),this.insertTimeTicks_timeValues=[],e.selectAll("text").each(function(e){t.insertTimeTicks_timeValues.push(e)}).on("click",function(e,i){var s=t.insertTimeTicks_timeValues[i],a=t.insertTimeTicks_timeValues[i+1];void 0===a&&(a=t.timeRange_ms.max),t.timeFilter_ms.min=s,t.timeFilter_ms.max=a,t.yearSetXPos(),t.updateItemFilterState_Time(),t.timeFilter.addFilter(!0)}),e.selectAll(".tick.major text").style("text-anchor","middle")},insertTimeChartAxis_1:function(){var t=this.root.select("g.timeAxisGroup"),e=t.append("g").attr("class","selection_bar");
e.append("title").attr("class","xaxis_title"),e.append("rect").attr("y",-2.5).attr("height",7);var i=t.selectAll(".filter_handle").data([1,2]).enter().append("g").attr("class",function(t,e){return"filter_handle "+(0===e?"filter_min":"filter_max")});i.append("line").attr("x1",0).attr("x2",0).attr("y1",1.5*this.getKshf().line_height-4),i.append("rect").attr("class","filter_nonselected").attr("y",0).attr("height",0).on("click",function(){d3.event.stopPropagation()});var i=t.selectAll(".filter_handle"),s=i.append("g");s.append("title").attr("class","xaxis_title"),s.append("path").attr("transform",function(t,e){return"translate("+(0===e?"0":"0")+",-12)"}).attr("d",function(t,e){return 0===e?"M0 6 L0 20 L12 13 Z":"M0 6 L0 20 L-12 13 Z"})},insertTimeChartAxis:function(){var t,e=this,i=this.getKshf(),s=this.root.select("g.timeAxisGroup");switch(this.timeticks.range){case d3.time.years:t=315576e5;break;case d3.time.months:t=26298e5;break;case d3.time.days:t=8766e4}this.lengthPerTick=t*this.timeScale.range()[1]/(this.timeZoom_ms.max-this.timeZoom_ms.min),s.select(".selection_bar rect").on("mousedown",function(){var a=this;this.style.stroke="orangered",e.divRoot.style("cursor","pointer");var r=d3.mouse(s[0][0])[0],o={min:e.timeFilter_ms.min,max:e.timeFilter_ms.max},n=e.timeFilter_ms,l=null;e.divRoot.on("mousemove",function(){var a=d3.mouse(s[0][0])[0],h=a-r,c=n.min,d=Math.round(h/e.lengthPerTick)*t;d!==l&&(l=d,0>d?(n.min=o.min+d,n.min<e.timeZoom_ms.min&&(n.min=e.timeZoom_ms.min),n.max=n.min+(o.max-o.min)):(n.max=o.max+d,n.max>e.timeZoom_ms.max&&(n.max=e.timeZoom_ms.max),n.min=n.max-(o.max-o.min)),c.min!==n.min&&(i.anim_barscale_duration=0,e.yearSetXPos(),e.updateItemFilterState_Time(),e.timeFilter.addFilter(!0)))}).on("mouseup",function(){a.style.stroke="",e.divRoot.style("cursor","default"),e.x_axis_active_filter=null,e.divRoot.on("mousemove",null).on("mouseup",null),e.refreshTimeChartDotConfig(),sendLog&&sendLog(CATID.FacetFilter,ACTID_FILTER.TimeDragRange,i.getFilteringState())})}),s.selectAll(".filter_handle g path").on("mousedown",function(t,a){var r=this;e.x_axis_active_filter=0===a?"min":"max",this.style.stroke="orangered",e.divRoot.style("cursor","pointer");var o=e.timeFilter_ms;e.divRoot.on("mousemove",function(){var t=d3.mouse(s[0][0])[0],a=Math.floor(e.timeZoom_ms.min+(e.timeZoom_ms.max-e.timeZoom_ms.min)*(t/e.options.timeMaxWidth)),n=new Date(a),l=null;if(e.timeticks.range===d3.time.years?l=kshf.Util.nearestYear(n):e.timeticks.range===d3.time.months?l=kshf.Util.nearestMonth(n):e.timeticks.range===d3.time.days&&(l=kshf.Util.nearestDay(n)),o[e.x_axis_active_filter]!==l.getTime()){if(o[e.x_axis_active_filter]=l.getTime(),o.max<o.min){r.style.stroke="",e.x_axis_active_filter="min"===e.x_axis_active_filter?"max":"min";var h=o.max;o.max=o.min,o.min=h}i.anim_barscale_duration=0,e.yearSetXPos(),e.updateItemFilterState_Time(),e.timeFilter.addFilter(!0),e.sortingOpt_Active.no_resort!==!0&&e.divRoot.attr("canResort",!0)}}).on("mouseup",function(){r.style.stroke="",e.divRoot.style("cursor","default"),e.x_axis_active_filter=null,e.divRoot.on("mousemove",null).on("mouseup",null),e.refreshTimeChartDotConfig(),sendLog&&("min"===e.x_axis_active_filter?sendLog(CATID.FacetFilter,ACTID_FILTER.TimeMinHandle,i.getFilteringState()):sendLog(CATID.FacetFilter,ACTID_FILTER.TimeMaxHandle,i.getFilteringState()))})}),this.yearSetXPos()},updateTimeChartBarsDots:function(){var t=this.getKshf(),e=t.barMaxWidth+t.scrollPadding+t.scrollWidth+t.sepWidth+t.getRowTotalTextWidth(),i=this;this.dom.timeBarTotal.transition().duration(t.anim_barscale_duration).attr("x",function(t){return e+i.timeScale(t.xMin)}).attr("width",function(t){return i.timeScale(t.xMax)-i.timeScale(t.xMin)}),this.dom.timeDots.transition().duration(t.anim_barscale_duration).attr("cx",function(t){return e+i.timeScale(t.timePos)})},getFilterMinDateText:function(){var t=new Date(this.timeFilter_ms.min);return this.timeticks.format(t)},getFilterMaxDateText:function(){var t=new Date(this.timeFilter_ms.max);return this.timeticks.format(t)},yearSetXPos:function(){var t=this.getKshf();if(this.timeFilter_ms.min=Math.max(this.timeFilter_ms.min,this.timeZoom_ms.min),this.timeFilter_ms.max=Math.min(this.timeFilter_ms.max,this.timeZoom_ms.max),this.timeFilter_ms.min>this.timeFilter_ms.max){var e=this.timeFilter_ms.min;this.timeFilter_ms.min=this.timeFilter_ms.max,this.timeFilter_ms.max=e}var i=this.timeScale(this.timeFilter_ms.min),s=this.timeScale(this.timeFilter_ms.max);this.options.timeMaxWidth-i>190?this.divRoot.select(".config_zoom").style("float","left").style("margin-left",i+"px"):this.divRoot.select(".config_zoom").style("float","right"),this.root.selectAll("g.filter_min").transition().duration(t.anim_barscale_duration).attr("transform","translate("+i+",0)"),this.root.selectAll("g.filter_max").transition().duration(t.anim_barscale_duration).attr("transform","translate("+s+",0)"),this.root.selectAll(".selection_bar rect").transition().duration(t.anim_barscale_duration).attr("x",i).attr("width",s-i),this.root.select("g.filter_min .filter_nonselected").transition().duration(t.anim_barscale_duration).attr("x",-i).attr("width",i),this.root.select("g.filter_max .filter_nonselected").transition().duration(t.anim_barscale_duration).attr("x",0).attr("width",this.options.timeMaxWidth-s),this.root.select("g.filter_min").attr("filtered",this.timeFilter_ms.min!==this.timeRange_ms.min),this.root.select("g.filter_max").attr("filtered",this.timeFilter_ms.max!==this.timeRange_ms.max),this.divRoot.attr("filtered_time",this.isFiltered_Time()?"true":"false"),this.divRoot.select(".zoom_in").attr("disabled",this.isFiltered_Time()?"false":"true"),this.refreshTimeChartTooltip()},text_item_Time:function(){return"from <b>"+this.getFilterMinDateText()+"</b> to <b>"+this.getFilterMaxDateText()+"</b>"},refreshTimeChartTooltip:function(){var t=this.getKshf().itemsSelectedCt+" selected "+this.getKshf().itemName+"from "+this.getFilterMinDateText()+" to "+this.getFilterMaxDateText();this.root.selectAll("title.xaxis_title").text(t)}};